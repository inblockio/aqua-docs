<!doctype html><html lang=en class=no-js>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=generator content="Hugo 0.88.0">
<meta name=robots content="index, follow">
<link rel="shortcut icon" href=/favicons/favicon.ico>
<link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180>
<link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16>
<link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32>
<link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36>
<link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48>
<link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72>
<link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96>
<link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144>
<link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192>
<title>Guardian | AQUA Protocol</title>
<meta name=description content="Shows access and transport layer logic used to interconnect data vaults
">
<meta property="og:title" content="Guardian">
<meta property="og:description" content="Shows access and transport layer logic used to interconnect data vaults
">
<meta property="og:type" content="article">
<meta property="og:url" content="https://aqua-protocol.org/docs/protocol/guardian/"><meta property="article:section" content="docs">
<meta property="article:modified_time" content="2022-02-12T13:13:02+08:00"><meta property="og:site_name" content="AQUA Protocol">
<meta itemprop=name content="Guardian">
<meta itemprop=description content="Shows access and transport layer logic used to interconnect data vaults
">
<meta itemprop=dateModified content="2022-02-12T13:13:02+08:00">
<meta itemprop=wordCount content="2747">
<meta itemprop=keywords content><meta name=twitter:card content="summary">
<meta name=twitter:title content="Guardian">
<meta name=twitter:description content="Shows access and transport layer logic used to interconnect data vaults
">
<link rel=preload href=/scss/main.min.c58ce5d45149df8e10859c3eb1022295682982407b61dc69aa80c9ba066ffb49.css as=style>
<link href=/scss/main.min.c58ce5d45149df8e10859c3eb1022295682982407b61dc69aa80c9ba066ffb49.css rel=stylesheet integrity>
<script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script>
</head>
<body class=td-page>
<header>
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
<a class=navbar-brand href=/>
<span class=navbar-logo><svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" inkscape:version="1.0 (4035a4f, 2020-05-01)" sodipodi:docname="logo.svg" style="enable-background:new 0 0 500 500" viewBox="0 0 500 500" id="Layer_1"><defs id="defs1204"/><sodipodi:namedview inkscape:current-layer="g2829" inkscape:window-maximized="1" inkscape:window-y="0" inkscape:window-x="0" inkscape:cy="250" inkscape:cx="242.13899" inkscape:zoom=".7919596" showgrid="false" id="namedview1202" inkscape:window-height="719" inkscape:window-width="1362" inkscape:pageshadow="2" inkscape:pageopacity="0" guidetolerance="10" gridtolerance="10" objecttolerance="10" borderopacity="1" bordercolor="#666666" pagecolor="#ffffff"/><g transform="matrix(1.6915379,0,0,1.6915379,21.321219,23.074018)" id="g2188"><g id="layer1" inkscape:label="Layer 1" style="display:inline;fill:red"><g style="fill:red" transform="matrix(0.26458333,0,0,0.26458333,86.390232,38.671175)" id="g231"><g style="fill:red" transform="matrix(23.961309,0,0,23.961309,-680.73085,-361.21096)" id="g2829"><rect ry="4.8628764" rx="4.7287874" y="6.8233423" x="12.794669" height="46.624615" width="46.624615" id="rect2196" style="font-variation-settings:normal;opacity:1;vector-effect:none;fill:#fff;fill-opacity:1;fill-rule:evenodd;stroke-width:.279113;stroke-linecap:square;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1;paint-order:stroke markers fill;stop-color:#000000;stop-opacity:1"/><path d="m35.447791 10.548529-7.752305 8.627971-1.245055 6.979947-3.626219 1.600087-1.542156 5.041488h-5.559041l.750057 1.21737h4.883323l.819785 2.678266h3.940492v1.217369h-3.568028l.275568.902326 4.702601 1.600088.146883.824908h3.568031v1.217373h-3.350652l.880792 5.760781 6.747958 1.506267 7.595425-.693916-.146629-3.514199h5.817177l1.044338-1.217371h-6.48546l1.139184-1.986652 7.317805-2.439098v-1.554972h-6.382923v-1.217371h6.382923v-3.083799h4.189916l.499357-1.291453-4.689273.07408v-6.09941l-6.241679-2.439866-1.859765-3.242475 1.045622-4.459588zm16.353874 26.550662v1.217371h2.71441l.882332-1.217371zm-23.91059 5.356531-.217379-1.217373H20.0511l1.044339 1.217373zm-5.342431-4.544695L22.17618 36.693658h-4.512396l1.044339 1.217369zm13.140621-25.797784 7.668741 5.03072-.952571 4.061745 2.329642 4.061487 5.84922 2.308621v5.222206 513e-6H22.555306l1.250442-4.089431 3.716963-1.630848 1.31119-7.350877zm-.11587 5.060709-.8608.860799 4.57802 4.578018.860797-.860797zm-.132531 2.58778-.860797.860797 4.578274 4.578017.860799-.860796zm-4.120448 3.837187-.860796.8608 4.578273 4.578017.860799-.860797zm-.132529 2.588035-.860797.86105 4.578017 4.578021.860799-.860798zm-.67828 8.943015h6.382923v1.217372h-6.382919zm4.842052 4.542388h6.382923v1.217369h-6.382923zm3.93152 4.624927h3.940496l-.372721 1.217371h-3.567775zm-7.785374.146628h4.558024v1.217371h-4.558024z" style="fill:#111;fill-opacity:1;stroke:none;stroke-width:.52221px;stroke-linecap:butt;stroke-linejoin:miter;stroke-opacity:1" id="path6155"/></g></g></g></g></svg></span><span class=font-weight-bold>AQUA Protocol</span>
</a>
<div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar>
<ul class="navbar-nav mt-2 mt-lg-0">
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class="nav-link active" href=/docs/><span class=active>Documentation</span></a>
</li>
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class=nav-link href=/docs/contribution-guidelines/><span>Contribution</span></a>
</li>
<li class="nav-item mr-4 mb-2 mb-lg-0">
<a class=nav-link href=/community/><span>Community</span></a>
</li>
</ul>
</div>
<div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.91e61f2708b654ec830cf0cff46ddfbd.json data-offline-search-base-href=/ data-offline-search-max-results=25>
</div>
</nav>
</header>
<div class="container-fluid td-outer">
<div class=td-main>
<div class="row flex-xl-nowrap">
<aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
<div id=td-sidebar-menu class=td-sidebar__inner>
<div id=content-mobile>
<form class="td-sidebar__search d-flex align-items-center">
<input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.91e61f2708b654ec830cf0cff46ddfbd.json data-offline-search-base-href=/ data-offline-search-max-results=25>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation">
</button>
</form>
</div>
<div id=content-desktop></div>
<nav class="collapse td-sidebar-nav" id=td-section-nav>
<ul class="td-sidebar-nav__section pr-md-3 ul-0">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-li>
<a href=/docs/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Documentation</span></a>
<ul class=ul-1>
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsoverview-li>
<a href=/docs/overview/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsoverview><span>Overview</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docsprotocol-li>
<a href=/docs/protocol/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsprotocol><span>Protocol</span></a>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsprotocolwhitepaper-li>
<a href=/docs/protocol/whitepaper/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsprotocolwhitepaper><span>Whitepaper</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsprotocolaqua-identity-protocol-li>
<a href=/docs/protocol/aqua-identity-protocol/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsprotocolaqua-identity-protocol><span>Identity Protocol</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsprotocolaqua-name-resolution-li>
<a href=/docs/protocol/aqua-name-resolution/ title="Aqua Name Resolution (ANS)" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsprotocolaqua-name-resolution><span>Name Resolution</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsprotocolassurance-levels-aal-li>
<a href=/docs/protocol/assurance-levels-aal/ title="Assurance Levels (AAL)" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsprotocolassurance-levels-aal><span>Assurance Levels</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsprotocoldata-accounting-li>
<a href=/docs/protocol/data-accounting/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsprotocoldata-accounting><span>Data Accounting</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsprotocoldata-governance-li>
<a href=/docs/protocol/data-governance/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsprotocoldata-governance><span>Data Governance</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsprotocoldelegated-witnessing-li>
<a href=/docs/protocol/delegated-witnessing/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsprotocoldelegated-witnessing><span>Delegated Witnessing</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsprotocoldesign-principles-li>
<a href=/docs/protocol/design-principles/ title="Design Princiciples" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsprotocoldesign-principles><span>Design Principles</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-docsprotocolguardian-li>
<a href=/docs/protocol/guardian/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-docsprotocolguardian><span class=td-sidebar-nav-active-item>Guardian</span></a>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsprotocolimmutable-hyperlinks-li>
<a href=/docs/protocol/immutable-hyperlinks/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsprotocolimmutable-hyperlinks><span>Immutable Hyperlinks</span></a>
</li>
</ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsimplementations-li>
<a href=/docs/implementations/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsimplementations><span>Implementations</span></a>
<ul class="ul-2 foldable">
<li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsimplementationsreference-architecture-li>
<a href=/docs/implementations/reference-architecture/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsimplementationsreference-architecture><span>Reference Implementation</span></a>
</li>
</ul>
</li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontribution-guidelines-li>
<a href=/docs/contribution-guidelines/ title="Contribution Guidelines" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscontribution-guidelines><span>Contribution</span></a>
</li>
</ul>
</li>
</ul>
</nav>
</div>
</aside>
<aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none">
<div class="td-page-meta ml-2 pb-1 pt-2 mb-0">
<a href=https://github.com/inblockio/aqua-docs/tree/main/content/en/docs/protocol/guardian.md class=td-page-meta--view target=_blank rel=noopener><i class="fa fa-file-alt fa-fw"></i> View page source</a>
<a href=https://github.com/inblockio/aqua-docs/edit/main/content/en/docs/protocol/guardian.md class=td-page-meta--edit target=_blank rel=noopener><i class="fa fa-edit fa-fw"></i> Edit This Page</a>
<a id=print href=https://aqua-protocol.org/docs/protocol/_print/><i class="fa fa-print fa-fw"></i> Print Page</a>
<a href="https://github.com/inblockio/aqua-docs/new/main/content/en/docs/protocol/guardian.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class=td-page-meta--child target=_blank rel=noopener>
<i class="fa fa-edit fa-fw"></i> Create Page
</a>
</div>
<div class=td-toc><nav id=TableOfContents>
<ul>
<li><a href=#how>How</a></li>
</ul>
<ul>
<li><a href=#permission-agreements--data-usage-agreement--access-rights><strong>Permission Agreements</strong> / Data Usage Agreement / Access Rights</a></li>
</ul>
<ul>
<li><a href=#domain-handshake>Domain Handshake</a></li>
<li><a href=#example-sharing-a-file>Example: Sharing a File</a>
<ul>
<li><a href=#specifications>Specifications:</a></li>
</ul>
</li>
</ul>
<ul>
<li><a href=#web-https--dns-integration-goal-have-a>Web (HTTPS / DNS) Integration Goal: Have a</a></li>
<li><a href=#ethereum-node>Ethereum Node</a>
<ul>
<li><a href=#matrix-node-handler>Matrix Node Handler</a></li>
<li><a href=#matrix-bot>Matrix-BOT</a></li>
</ul>
</li>
</ul>
</nav></div>
</aside>
<main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main>
<nav aria-label=breadcrumb class=td-breadcrumbs>
<ol class=breadcrumb>
<li class=breadcrumb-item>
<a href=https://aqua-protocol.org/docs/>Documentation</a>
</li>
<li class=breadcrumb-item>
<a href=https://aqua-protocol.org/docs/protocol/>Protocol</a>
</li>
<li class="breadcrumb-item active" aria-current=page>
<a href=https://aqua-protocol.org/docs/protocol/guardian/>Guardian</a>
</li>
</ol>
</nav>
<div class=td-content>
<h1>Guardian</h1>
<div class=lead>Shows access and transport layer logic used to interconnect data vaults</div>
<header class=article-meta>
</header>
<h1 id=context>Context</h1>
<p>It is highly problematic to expose sensitive data, such as personal
identifiable data, to the internet. The service who hosts that sensitive
data, needs to be compromised only for a short amount of time, to leak
all the data. Often caused by configuration mistakes or by
vulnerabilities being present in the used technology stack.</p>
<p>We can&rsquo;t effort to have leaks on personal-identifiable data in data
vaults. To raise the bar on making attacks difficult and reducing the
chance of leakage of information, we introduce the Guardian as a extra
security layer to protect services like the PKC from attacks.</p>
<h1 id=summary>Summary</h1>
<p>The Guardian is a software which manages the boundaries of your digital
domain. Guardians are used to connect to secure transport networks
(HTTPS, Matrix Network, Didcomm) and publishing networks (e.g.
Swarm.eth). The Guardian is used to build trusted connections to other
Guardians via trusted transport-layers to exchange data with them. As
the Guardian connects to other Guardians, it also manages all
connections to services in it&rsquo;s domain and access to those services.</p>
<h1 id=goal>Goal</h1>
<p>Secure all services behind the Guardian from attacks and unauthorized
access. Keep the data vault and it&rsquo;s data private and safe, while
enabling the ability to exchange data with other Guardians.</p>
<h2 id=how>How</h2>
<p>Enforcement is handled on each connection and each data set so that
services behind the Guardian are never directly exposed. This makes the
Guardian the most security sensitive component in the Aqua reference
implementation, as we expect the Guardian to handle all incoming and
outgoing traffic. The Guardian enjoys additional attention and effort to
be up to it&rsquo;s task by hardening it and applying security best practices
to ensure that it is fulfilling it&rsquo;s security promise to keep services
behind the Guardian safe.</p>
<p>Every transaction leaving or wanting to enter your domain will be
supervised and checked by the Guardian. The core functionality of the
Guardian is a library to verify the Aqua Protocol. Only if the
verification succeeds additional steps are introduced to make decisions
how the data is handled.</p>
<p>This allows the Guardian to read and understand Aqua verified data. This
allows for the implementation of a wide set of behavioral rules and
offers the opportunity to create various &lsquo;Smart contract&rsquo; languages on
top of it.</p>
<p>The Guardian verifies a file, reads its contents and checks it&rsquo;s
permissions to classify if an action is considered legal or illegal,
permitted or denied. Basic functionality for a Guardian can be compared
with a traditional firewall, or a application firewall but is much more
sophisticated to manage access on the data-level.</p>
<h1 id=terminology>Terminology:</h1>
<p>Proving ownership over a domain by signing the domain ID with an
self-issued identity claim which is also registered in a claim registry
to ensure nobody claims to have owned that domain before by manipulating
the digital clock and faking an earlier owner-ship claim over the
domain.</p>
<h2 id=permission-agreements--data-usage-agreement--access-rights><strong>Permission Agreements</strong> / Data Usage Agreement / Access Rights</h2>
<p>are contracts which represent the terms and conditions under which files
and/or services are shared with other accounts and/or their digital
domains.</p>
<p>By nature those Permission Agreements will be compiled through pages and
stored as files. To form an agreement, the other party must be notified
about new resources as they become available. For example, when we share
a page with another account. To complete a permission agreement, the
counter party has to sign the permission agreement or reject it. If the
permission agreement is signed, the other party enters a contractual
relationship in which they will be liable for any agreement violates
executed from their digital domain.</p>
<h1 id=processes>Processes</h1>
<h2 id=domain-handshake>Domain Handshake</h2>
<p>Establish trust between two Aqua domains. For this we have Alice and Bob which
want to establish trust between their domains. They both have a Guardian in
place to protect their data vaults.</p>
<p>Step 1) Alice: Create access contract:
I &lt;Alice_account> want to connect from my &lt;domain_id> to a &lt;domain_id> controlled by &lt;Bobs_account> with my &lt;alice_domain_id> via the following channel: DNS/HTTPS via &lt;alice_Guardian.domain.com>.
Step 2) Alice: sign contract
Step 3) Alice: SEND contract send the page via &lsquo;mail&rsquo; / &lsquo;matrix&rsquo; whatever to the remote PKC instance.
Step 4) Bob: veries the contract contract and imports it
Step 5) Bob: extend contract: I &lt;bobs_acocunt> connect my PKC &lt;bobs_domain_id> to your PKC &lt;Alice_domain_id> via my Guardian_endpoint &lt;bobs_guardian.domain2.com>.
Step 6) Bob: sign extended contract: Bob uses his wallet to sign his extended contract.
Step 7) Bob: send extended contract TO Alice: Bob sends his Contract to his Guardian.
Step 8) Bob&rsquo;s Guardian: Verifies and sends the contract to Alice Guardian.
Step 9) Alice Guardian:
Guardian verifies all data
Sends OK back to Bob&rsquo;s Guardian
Sends Updates contract into Alice PKC
Waits for Bob&rsquo;s Guardian to request available pages
Step 10) Bob&rsquo;s Guardian requests a list of pages: ' What pages do you share with me?'
Step 11) Alice Guardian: Returns list of accessible resources for Bob</p>
<h2 id=example-sharing-a-file>Example: Sharing a File</h2>
<p>Target: Sharing a file with another account. Using two Aqua data vaults
with their two Guardians to manage access to them. We assume the
Guardians already have executed a handshake to enter a trusted
relationship. We also assume, that the file should underlay access
basedon account restrictions and domain restrictions.</p>
<p><strong>Example 1:</strong> Sharing a file <strong>without additional</strong> constrains with
another account.</p>
<p>Alice wants to share her page &lsquo;My secret research&rsquo; with Bob. Their
Guardians have already formed a trusted connection. What Alice needs to
do now is to add a sub-page with an immutable link under the &lsquo;My secret
research&rsquo; page and define access. To be able to define access Alice
needs to have a claim over the ownership over the domain she is sharing
from.</p>
<p>Alice creates an Access Permission for the whole page or for a single
revision by creating a page with the following syntax:</p>
<ul>
<li>
<p>&lt;genesis_hash>:access_contract</p>
</li>
<li>
<p>To give access to the whole page with all it&rsquo;s revisions.</p>
</li>
<li>
<p>&lt;revision_hash>:access_contract</p>
</li>
<li>
<p>To give access to a specific revision.</p>
</li>
</ul>
<hr>
<p><strong>Content of the page:</strong></p>
<p>I Alice <alice-account> give access to Bob <bob-account></p>
<ul>
<li>option 1: to the whole page including it&rsquo;s history &lt;genesis_hash></li>
<li>option 2: to the following revision &lt;revision_hash>&lsquo;My secret
research&rsquo;</li>
</ul>
<p><strong>Additional one-sided conditions:</strong></p>
<ul>
<li>This access contract expires in 7 days</li>
</ul>
<p>This contract will come into place with my <alice-account> signature.</p>
<p>The Guardian will react to a specific syntax of pages holding contracts,
agreements and access rights to adjust his network access rights
accordingly to it. Alice-Guardian will respond to the question what
resources are shared by Bobs-Guardian with the answer that there is a
new page available according to the access contract which now gives
Bobs-Guardian the ability to query the content of &lsquo;My secure research&rsquo;
from Alice according to the contract. Depending on Bobs-Guardian
setting, the Guardian might automatically load the resource and forward
it into the post-box of Bobs Data Vault.</p>
<p><strong>Example 2:</strong> Sharing a file <strong>with</strong> constrains forming a <strong>contract</strong>
to do so.</p>
<p>Same as 1 expect that for the contract to come into place, Bob needs to
sign the contract from Alice containing additional constrains.</p>
<hr>
<p><strong>Content of the page:</strong></p>
<p>I Alice <alice-account> give access to Bob <bob-account></p>
<ul>
<li>option 1: to the whole page including it&rsquo;s history &lt;genesis_hash></li>
<li>option 2: to the following revision &lt;revision_hash>&lsquo;My secret
research&rsquo;</li>
</ul>
<p><strong>Under the following conditions:</strong></p>
<ul>
<li>Do not share outside your domain &lt;Bobs-domain_id></li>
<li>Do not share with any body else (Bobs domain can&rsquo;t have another
account registered to it, if there is an account registered the
Guardian of Bob will say that Bobs domain does not fulfill the
requirements to establish this contract.</li>
<li>Do not modify it.</li>
<li>Delete it after 7 days.</li>
</ul>
<p>For this contract to be valid, signatures of first Alice and then Bob
need to be present. This means, after Alice signed the access contract,
the contract is a new available resource to Bob to be loaded. Bob can
now sign the resource in his domain and return the contract. Leading to
the contract send back to Alice domain and being updated there. Bob now
gets access to &lsquo;My secret research&rsquo; which has been updated as well, to
contain via an immutable link the access contract.</p>
<p>Permission Templates, Complex Permissions (Groups and more)</p>
<p>It is possible to apply complex permissions based on templates, or and
connecting multiple access contracts by using</p>
<ul>
<li>instead of this syntax &lt;genesis_hash>:permission_agreement</li>
<li>the following the syntax &lt;genesis_hash>:&lt;genesis_hash-2> in
which the &lt;genesis_hash-2> contains a list of sub-pages with access
contracts which can be used to apply access via permission-objects
which are represented by the &lt;genesis_hash-2> page object.</li>
</ul>
<ol>
<li>Alice wants to</li>
<li>If the user wants to propose changes to the page, he will send an
updated PAGE FILE to the OWNER of the PAGE.</li>
<li>The owner can decide to ACCEPT the changes. Or to include the
changes in the HISTORY File, but not COMMIT them. Or to NOT include
the update of the PAGE, and disregard it.</li>
</ol>
<hr>
<h3 id=specifications>Specifications:</h3>
<p>The Guard Daemon checks if there is digital contract present in his
domain. Those contracts set permissions for allowing a counter party to
access a service or resource (like a file or a page, or a revision).
It&rsquo;s also defining the constrains under which permissions access is
given. In this case it requires the digital signature of the receiving
party for the agreement to come into place and be valid.</p>
<p>Guardians have administrative access to the services they manage.
Therefore they can supervise the activities of services and use them as
triggers to e.g. provide access according to a set permission without
additional user action.</p>
<h1 id=guardian-components>Guardian Components:</h1>
<p>APIs</p>
<ul>
<li>
<p>System-API to control a service via a service specific library. Each
services will have their own control-library and control API to
create an abstraction layer which allows for a unified control logic
in the Guardian.</p>
<ul>
<li>E.g. an account is allowed to access a service</li>
<li>E.g. a resource is shared with an account</li>
<li>E.g. a trust relationship between two services is established
(based on an agreement between two accounts) to exchange data</li>
<li><strong>Implementation Specific PKC:</strong> All interactions for system
interaction with MediaWiki / PKC
<ul>
<li>Execute Actions: Move, Update, Edit, Delete Pages</li>
<li>Request send to the Guardian: Verify a specific page or a
list of pages</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Data-API</strong> to retrieve Aqua-Data between a service and the
Guardian, or between two Guardians.</p>
<ul>
<li>Send data to import API</li>
<li>Read data via export API
<ul>
<li><strong>Implementation Specific PKC:</strong> Read special Pages used to
give access e.g. Data Usage Agreements, Permission
Agreements</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Aqua Verification Library</strong> to be able to verify incoming and
outgoing data</p>
<ul>
<li>implementation of the &lsquo;external-verifier&rsquo; in e.g. GO, Typescript
or Javascript (current)</li>
</ul>
</li>
<li>
<p>Account-Registry (Holding the list of trusted keys and the
relationship between them)</p>
<ul>
<li>This includes defined &lsquo;trusted accounts&rsquo;</li>
</ul>
</li>
<li>
<p>Session-Handler/Registry (Acts like Stateful-Firewall on the
page-object level to mange imports / exports). The Guardian verifies
incoming and outgoing data and constructs sessions based on it.</p>
</li>
<li>
<p>Guardian Policies: Are sets of rules followed and enforced by the
Guardian. This includes set of rules used to protect the domain from
unauthorized operations and access. Part of that are page access
permissions which are managed by the
<a href=Data_Usage_Agreement title=wikilink>Data Usage
Agre</a>
<a href=Data_Usage_Agreement title=wikilink>ement</a>
s.</p>
<ul>
<li>&lt;domain_id><account>&lt;genesis_hash>&lt;revision_hash>:&lt;domain_id><account>&lt;genesis_hash>&lt;revision_hash></li>
</ul>
</li>
<li>
<p>Transport Layer API&rsquo;s / Sub-Modules for connectivity to distributed
services</p>
<ul>
<li>The Guardian-to-Guardian communication handler (via DNS/HTTPS
transport)</li>
<li>Ethereum Integration, Ethereum Handler (As a witness Network)</li>
<li>Matrix Integration, Matrix Handler (As a restrictive/
permissioned transport layer)</li>
<li>Schwarm Integration, Swarm Handler (As a publishing network)</li>
</ul>
</li>
</ul>
<h1 id=guardian-integration-services>Guardian-Integration-Services</h1>
<p>The Guardian has a modular design to support integration with many services and
transport layers.</p>
<h2 id=web-https--dns-integration-goal-have-a>Web (HTTPS / DNS) Integration Goal: Have a</h2>
<p>handler to connect web-facing Guardians with each other in a safe way. Be able
to run guardian procedures via two public Facing guardians which use a public
DNS name and HTTPS to interconnect with each other. Guardian procedures are:
Guardian handshakes to establish trust or remove trust Request or Send portable
Hash-Chains based on access rights between each other</p>
<h2 id=ethereum-node>Ethereum Node</h2>
<p>Integration Goal: Connect to a self-hosted or remote Ethereum Node. Option 1:
Configuration via Alchemy (Providing Keys) via Special:DataAccountingConfig
Option 2: Implementation of Ethereum Node via ./setup &ndash;ethereum-node (provide
container) Configuration of Connection to RPC Ethereum node via address (if in
same network) The Wallet can be directly be connected to a local Ethereum node
via RPC to avoid meta-data gathering of large providers, like INFURA which
could potential track which IP address has created which Ethereum Transaction
with which Metamask-Wallet, leading to a de-pseudonymousation of the user. ###
Ethereum Node Handler Goal: Accelerate lookups of the Guardian via caching
Every-time a witness contract is called, the Ethereum Node Handler will start
to cache the all Ethereum-Witness events of that Witness-Contract and Index
them in it&rsquo;s database. This will reduce access times to ms vs potential seconds
in lookup times, making the Guardian more performant and responsive. ## Matrix
Node Integration Goal: Connect to a self-hosted or remote synapse-server
(MATRIX) Node. Configure a remote matrix server or a local one via Guardian.
Implementation of Matrix-Node deployment via ./pkc setup &ndash;matrix-node (provide
container).</p>
<h3 id=matrix-node-handler>Matrix Node Handler</h3>
<p>Context: We use Ethereum Wallets as Identity-Anchors as they are globally
unique addresses (which are collision free) broadly adopted with supported
hardware ledgers as secure hardware elements with an existing fast moving
ecosystem for further development. They act as &lsquo;web-based&rsquo; PGP-like utilities
which do not need any Blockchain-Interaction for Signing messages and can be
used as a valuable off-line capable identity anchor. With this step we separate
Identity and Service; even in case of compromising the computer of the user or
by having a breach of secrets in the Element-Client the Identity would be safe
(in case a hardware wallet would be used). This also drastically reduces attack
surface to phish a users credentials; as there is no Password-Login there is no
way to steal the password to impersonate the user. All security assumptions of
the User-Identity come back to the security of his private key. For the
Kolibri/PKC project this is the foundation for using wallet-addresses as
Identities to route traffic with matrix bots between PKC&rsquo;s. The following
actions are required to use the Ethereum Wallet as a strong Identity Anchor
within Matrix.</p>
<p>This requires the following functionality:</p>
<ul>
<li>Register the user via an Ethereum wallet address (successfully piloted by inblockio)</li>
<li>Detect that it is an Ethereum Wallet-Address; Verify integrity of address with the Ethereum Wallet-Address Checksum (TBD)</li>
<li>Make username not changeable (Done via Matrix settings,successfully piloted by inblockio)</li>
<li>Wallet login with Web-Wallet Metamask via OIDC (Open ID Connect) (successfully Piloted by inblockio)</li>
<li>Verify Ownership of the Wallet by doing an Element-Client side Signature Challenge to the User. Challenge resolved by signing a message with sufficient entropy to not be ever the same (to protect against leakage) with the private key via the Ethereum
Metamask Webwallet (or a connected Hardware-Wallet)</li>
<li>Implement a User-to-User request of proof of Identity Users / Server can challenge other users to proof that they hold the private Wallet-Key by triggering the Signature Challenge to the User; After the challenge is done, the requested party is provided with all information to do a manual verification of the signature (the Message which was
Signed, the Signature, the used method used for the signature)</li>
</ul>
<h3 id=matrix-bot>Matrix-BOT</h3>
<p>Context: The Matrix-Network communicates with the PKC through the Guardian who
will manage all access to the MediaWiki service. The Guardian uses a Matrix-Bot (to
handle the communication) and a Matrix-Integration (to be flexible to use a
private synapse or a remote synapse server) to interact with the Matrix Network
as a permissioned transport layer.</p>
<p>Referenz-Implementation:
Suitable options for a matrix-integration are &lsquo;go-lang&rsquo; or &lsquo;rust&rsquo;. Guardian
next generation Guardian will be written in Rust, so integration of security
relevant components would be preferably in Rust and Webassambly. A central
point to configure the guardian to connect to matrix and other services needs
to be provided. The matrix server is connected to the guardian with a service
bot which is able to open rooms to exchange revisions between PKC’s.</p>
<p>Required Functionality of the Matrix-Bot:</p>
<ul>
<li>open new room for user (required) - to share ressource invite / remove other
users to/ from room (required) - to set permissions who can read</li>
<li>shared resource close room (required) - after resource share is revoked join a
room the user is invited too (by other matrix-bot)
*&lsquo;accept invite&rsquo; check for
challenge (provided via text from remote Guardian), leave room if challenge is
faulty and block user (required) delete? room / delete history?
Note: Use matrix only as channel not as storage (optional) preferably the
history of the channel is not kept</li>
<li>post content of (mediawiki API query results from the Guardian) into a room</li>
<li>(required) read content of room (send it to the Guardian for verification,
before it&rsquo;s send to the import API) (required)</li>
</ul>
<div class="text-muted mt-5 pt-3 border-top">
Last modified February 12, 2022: <a href=https://github.com/inblockio/aqua-docs/commit/1bc8898da6413e19d8b38a4043bcb28a59b10427>docs: ✏️ Adding more context to guardian (1bc8898)</a>
</div>
</div>
</main>
</div>
</div>
<footer class="bg-dark py-5 row d-print-none">
<div class="container-fluid mx-sm-5">
<div class=row>
<div class="col-6 col-sm-4 text-xs-center order-sm-2">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list">
<a class=text-white target=_blank rel=noopener href=mailto:info@inblock.io aria-label="User mailing list">
<i class="fa fa-envelope"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter>
<a class=text-white target=_blank rel=noopener href=https://twitter.com/inblockio aria-label=Twitter>
<i class="fab fa-twitter"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Matrix aria-label=Matrix>
<a class=text-white target=_blank rel=noopener href=https://matrix.to/#/#aqua-community:matrix.jembawan.com aria-label=Matrix>
<i class="fa fa-comment"></i>
</a>
</li>
</ul>
</div>
<div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
<ul class="list-inline mb-0">
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub>
<a class=text-white target=_blank rel=noopener href=https://github.com/inblockio aria-label=GitHub>
<i class="fab fa-github"></i>
</a>
</li>
<li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow">
<a class=text-white target=_blank rel=noopener href=https://stackoverflow.com/questions/tagged/aqua aria-label="Stack Overflow">
<i class="fab fa-stack-overflow"></i>
</a>
</li>
</ul>
</div>
<div class="col-12 col-sm-4 text-center py-2 order-sm-2">
<small class=text-white>&copy; 2022 AQUA Protocol All Rights Reserved</small>
<small class=ml-1><a href=https://aqua-protocol.org/privacy target=_blank rel=noopener>Privacy Policy</a></small>
</div>
</div>
</div>
</footer>
</div>
<script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.8ab8f81ff7e1454d30024cd6f956d4d341c3a97e2a673f988065f2ee4e147922.js integrity="sha256-irj4H/fhRU0wAkzW+VbU00HDqX4qZz+YgGXy7k4UeSI=" crossorigin=anonymous></script>
</body>
</html>