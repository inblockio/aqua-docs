1:"$Sreact.fragment"
2:I[339756,["/mint-test/_next/static/chunks/d96012bcfc98706a.js","/mint-test/_next/static/chunks/d80b3790a119a285.js"],"default"]
3:I[837457,["/mint-test/_next/static/chunks/d96012bcfc98706a.js","/mint-test/_next/static/chunks/d80b3790a119a285.js"],"default"]
5:I[897367,["/mint-test/_next/static/chunks/d96012bcfc98706a.js","/mint-test/_next/static/chunks/d80b3790a119a285.js"],"OutletBoundary"]
6:"$Sreact.suspense"
8:I[897367,["/mint-test/_next/static/chunks/d96012bcfc98706a.js","/mint-test/_next/static/chunks/d80b3790a119a285.js"],"ViewportBoundary"]
a:I[897367,["/mint-test/_next/static/chunks/d96012bcfc98706a.js","/mint-test/_next/static/chunks/d80b3790a119a285.js"],"MetadataBoundary"]
c:I[168027,["/mint-test/_next/static/chunks/d96012bcfc98706a.js","/mint-test/_next/static/chunks/d80b3790a119a285.js"],"default"]
:HL["/mint-test/_next/static/chunks/8a80e7184ad3a13f.css","style"]
:HL["/mint-test/_next/static/chunks/ec0800f16b1ae8cd.css","style"]
:HL["/mint-test/_next/static/media/797e433ab948586e-s.p.dbea232f.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
:HL["/mint-test/_next/static/media/caa3a2e1cccd8315-s.p.853070df.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
0:{"P":null,"b":"EZwUkCeXLgAQq-pD-Y62S","c":["","docs","v3.0.0","schema"],"q":"","i":false,"f":[[["",{"children":["docs",{"children":[["version","v3.0.0","d"],{"children":[["slug","schema","c"],{"children":["__PAGE__",{}]}]}]}]},"$undefined","$undefined",true],[["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/mint-test/_next/static/chunks/8a80e7184ad3a13f.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}],["$","link","1",{"rel":"stylesheet","href":"/mint-test/_next/static/chunks/ec0800f16b1ae8cd.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","suppressHydrationWarning":true,"children":["$","body",null,{"className":"font-sans antialiased","children":["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]],[]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]}]]}],{"children":[["$","$1","c",{"children":[null,["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["$","$1","c",{"children":[null,["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["$","$1","c",{"children":[null,["$","$L2",null,{"parallelRouterKey":"children","error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":[["$","$1","c",{"children":["$L4",[["$","script","script-0",{"src":"/mint-test/_next/static/chunks/5e52b2e731b92ce4.js","async":true,"nonce":"$undefined"}],["$","script","script-1",{"src":"/mint-test/_next/static/chunks/a37691990cb744b1.js","async":true,"nonce":"$undefined"}]],["$","$L5",null,{"children":["$","$6",null,{"name":"Next.MetadataOutlet","children":"$@7"}]}]]}],{},null,false,false]},[["$","div","l",{"className":"flex items-center justify-center min-h-screen","children":["$","div",null,{"className":"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900"}]}],[],[]],false,false]},null,false,false]},null,false,false]},null,false,false],["$","$1","h",{"children":[null,["$","$L8",null,{"children":"$@9"}],["$","div",null,{"hidden":true,"children":["$","$La",null,{"children":["$","$6",null,{"name":"Next.Metadata","children":"$@b"}]}]}],["$","meta",null,{"name":"next-size-adjust","content":""}]]}],false]],"m":"$undefined","G":["$c",[]],"S":true}
d:I[77988,["/mint-test/_next/static/chunks/5e52b2e731b92ce4.js","/mint-test/_next/static/chunks/a37691990cb744b1.js"],"MobileDocLayout"]
e:I[667248,["/mint-test/_next/static/chunks/5e52b2e731b92ce4.js","/mint-test/_next/static/chunks/a37691990cb744b1.js"],"Header"]
f:I[193649,["/mint-test/_next/static/chunks/5e52b2e731b92ce4.js","/mint-test/_next/static/chunks/a37691990cb744b1.js"],"Sidebar"]
10:T3875,
# Aqua Protocol v3 Concepts

Understanding the core concepts of Aqua Protocol v3 is essential for effectively using the SDK and building applications. This guide covers the fundamental ideas, terminology, and patterns used throughout the protocol.

## AquaTree

The **AquaTree** is the primary data structure in v3. It represents a complete, self-contained collection of revisions with their relationships and metadata.

### Structure

```typescript
interface AquaTree {
  revisions: Revisions      // All revisions indexed by hash
  file_index: FileIndex     // Maps file hashes to filenames
  tree?: RevisionTree       // Tree structure of revisions
  treeMapping?: TreeMapping // Path mappings for navigation
}
```

### Components

#### 1. Revisions
A flat map of all revisions, keyed by their verification hash:

```typescript
{
  "0xabc123...": {
    previous_verification_hash: "0xdef456...",
    local_timestamp: "2024-01-01T12:00:00",
    revision_type: "file",
    // ... other fields
  },
  "0xdef456...": {
    // ... another revision
  }
}
```

#### 2. File Index
Maps file content hashes to filenames for reference:

```typescript
{
  "0xfile_hash_1": "document.pdf",
  "0xfile_hash_2": "image.png"
}
```

#### 3. Tree Structure (Optional)
Hierarchical representation showing parent-child relationships:

```typescript
{
  hash: "0xabc123...",  // Root revision
  children: [
    {
      hash: "0xdef456...",
      children: [...]
    }
  ]
}
```

#### 4. Tree Mapping (Optional)
Path information for each revision:

```typescript
{
  paths: {
    "0xabc123": ["0xroot", "0xabc123"],
    "0xdef456": ["0xroot", "0xabc123", "0xdef456"]
  },
  latestHash: "0xdef456..."  // Most recent revision
}
```

## Revisions

A **Revision** is a single entry in the AquaTree representing an operation or state change.

### Common Fields

All revisions share these base fields:

| Field | Type | Description |
|-------|------|-------------|
| `previous_verification_hash` | string | Hash linking to previous revision (empty string for genesis) |
| `local_timestamp` | string | ISO 8601 timestamp when revision was created |
| `revision_type` | string | One of: `"file"`, `"form"`, `"signature"`, `"witness"`, `"link"` |
| `version` | string | Protocol version with method: `https://aqua-protocol.org/docs/v3/schema_2 \| SHA256 \| Method: scalar/tree` |

### Genesis Revision

The **genesis revision** is the first revision in a chain:
- `previous_verification_hash` is an empty string `""`
- Typically a file or form revision
- Establishes the initial state

### Verification Hash

Each revision has a unique **verification hash** computed from its canonical form:

```typescript
hash = SHA256(canonicalized_revision_data)
```

This hash serves as:
- Unique identifier for the revision
- Key in the revisions map
- Reference in `previous_verification_hash` fields

## Revision Types

### 1. File Revision

Stores file metadata and optionally content.

**Purpose**: Document file presence and content integrity

**Fields**:
- `file_hash`: SHA256 hash of file content
- `file_nonce`: Random nonce for uniqueness
- `content`: Optional file content (text or binary)
- `leaves`: Array of hashes (tree mode only)

**Example**:
```json
{
  "previous_verification_hash": "",
  "local_timestamp": "2024-01-01T12:00:00",
  "revision_type": "file",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "file_hash": "0x9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08",
  "file_nonce": "0x3fa8b1c2d3e4f5a67b8c9d0e1f2a3b4c"
}
```

### 2. Form Revision

Stores structured key-value data.

**Purpose**: Capture form submissions, structured data, or metadata

**Fields**:
- `file_hash`: Hash of form data
- `file_nonce`: Random nonce
- `content`: Form data as key-value object
- `leaves`: Array of hashes (tree mode only)

**Example**:
```json
{
  "previous_verification_hash": "",
  "local_timestamp": "2024-01-01T12:00:00",
  "revision_type": "form",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: tree",
  "file_hash": "0xabc123...",
  "file_nonce": "0x123abc...",
  "content": {
    "name": "John Doe",
    "email": "john@example.com",
    "status": "approved"
  },
  "leaves": ["0x...", "0x...", "0x..."]
}
```

### 3. Signature Revision

Adds cryptographic signature to prove authenticity.

**Purpose**: Authenticate revisions and establish authorship

**Fields**:
- `signature`: Signature value (format depends on type)
- `signature_type`: One of `"cli"`, `"metamask"`, `"did"`, `"p12"`, `"inline"`
- `signature_wallet_address`: Ethereum address (for cli/metamask)
- `signature_public_key`: Public key (for p12)

**Example (MetaMask)**:
```json
{
  "previous_verification_hash": "0xabc123...",
  "local_timestamp": "2024-01-01T12:01:00",
  "revision_type": "signature",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "signature_type": "metamask",
  "signature": "0x8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f...",
  "signature_wallet_address": "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb8"
}
```

**Example (DID)**:
```json
{
  "previous_verification_hash": "0xabc123...",
  "local_timestamp": "2024-01-01T12:01:00",
  "revision_type": "signature",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "signature_type": "did",
  "signature": {
    "payload": "eyJhbGciOi...",
    "signatures": [{
      "protected": "eyJhbGci...",
      "signature": "..."
    }]
  }
}
```

### 4. Witness Revision

Anchors revision to external timestamping service.

**Purpose**: Prove existence at specific time via blockchain or TSA

**Fields**:
- `witness_merkle_root`: Root hash of Merkle tree
- `witness_timestamp`: Unix timestamp from witness service
- `witness_network`: Network used (`"mainnet"`, `"sepolia"`, `"holesky"`, `"tsa"`, `"nostr"`)
- `witness_smart_contract_address`: Contract address (Ethereum)
- `witness_transaction_hash`: Transaction hash
- `witness_sender_account_address`: Account that witnessed
- `witness_merkle_proof`: Merkle proof array

**Example (Ethereum)**:
```json
{
  "previous_verification_hash": "0xabc123...",
  "local_timestamp": "2024-01-01T12:02:00",
  "revision_type": "witness",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "witness_merkle_root": "0xdef456...",
  "witness_timestamp": 1704110520,
  "witness_network": "sepolia",
  "witness_smart_contract_address": "0x5FbDB2315678afecb367f032d93F642f64180aa3",
  "witness_transaction_hash": "0x9f86d081...",
  "witness_sender_account_address": "0x742d35Cc...",
  "witness_merkle_proof": []
}
```

### 5. Link Revision

Connects to other AquaTree chains.

**Purpose**: Establish relationships between separate chains

**Fields**:
- `link_type`: Type of link relationship (application-specific)
- `link_verification_hashes`: Array of hashes from other chains
- `link_file_hashes`: Array of corresponding file hashes

**Example**:
```json
{
  "previous_verification_hash": "0xabc123...",
  "local_timestamp": "2024-01-01T12:03:00",
  "revision_type": "link",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "link_type": "dependency",
  "link_verification_hashes": [
    "0x111...",
    "0x222...",
    "0x333..."
  ],
  "link_file_hashes": [
    "0xaaa...",
    "0xbbb...",
    "0xccc..."
  ]
}
```

## Methods: Scalar vs Tree

V3 supports two canonicalization methods, specified in the version string.

### Scalar Method

**Format**: `Method: scalar`

**How it works**:
- Revision is serialized as-is
- Hash computed directly from canonical JSON
- Simple, straightforward

**When to use**:
- Small revisions
- Simple file/form data
- Quick operations

**Example**:
```typescript
version: "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar"
// No leaves field
```

### Tree Method

**Format**: `Method: tree`

**How it works**:
- Content broken into key-value leaves
- Each leaf hashed individually
- Merkle tree constructed from leaves
- Root becomes the verification hash

**When to use**:
- Large files or forms
- Selective disclosure needed
- Proof of specific fields

**Example**:
```typescript
version: "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: tree"
leaves: [
  "0xhash_of_key_value_1",
  "0xhash_of_key_value_2",
  "0xhash_of_key_value_3"
]
```

**Leaf Generation**:
```typescript
// For form data: { "name": "John", "email": "john@example.com" }
leaves = [
  SHA256("name:John"),
  SHA256("email:john@example.com")
]
```

## Chains and Trees

### Linear Chain

Simple sequence of revisions:

```
Genesis ï¿½ Signature ï¿½ Witness ï¿½ Update ï¿½ Signature ï¿½ Witness
```

Each revision references the previous one.

### Branching Tree

Multiple paths from a common ancestor:

```
            Genesis
               ï¿½
          Signature
             /  \
        Branch A  Branch B
           ï¿½        ï¿½
        Update 1  Update 2
```

V3 supports branching, allowing parallel development paths.

### Path Mapping

The `treeMapping` provides paths to each revision:

```typescript
{
  paths: {
    "genesis_hash": ["genesis_hash"],
    "sig_hash": ["genesis_hash", "sig_hash"],
    "branch_a_hash": ["genesis_hash", "sig_hash", "branch_a_hash"],
    "branch_b_hash": ["genesis_hash", "sig_hash", "branch_b_hash"]
  },
  latestHash: "branch_a_hash"  // Longest path
}
```

## File Object

Input format for creating revisions:

```typescript
interface FileObject {
  fileName: string           // Display name
  fileContent: string |      // Text content
                AquaTree |   // Linked tree
                Uint8Array | // Binary data
                Record<string, string> | // Form data
                object       // Structured data
  path: string              // File path
  fileSize?: number         // Size in bytes
}
```

### Content Types

**Text**: Plain text, HTML, JSON
```typescript
{
  fileName: "doc.txt",
  fileContent: "Hello World",
  path: "/docs/doc.txt"
}
```

**Binary**: Images, PDFs, any binary file
```typescript
{
  fileName: "image.png",
  fileContent: new Uint8Array([...]),
  path: "/images/image.png"
}
```

**Form**: Key-value structured data
```typescript
{
  fileName: "form.json",
  fileContent: {
    "field1": "value1",
    "field2": "value2"
  },
  path: "/forms/form.json"
}
```

**Link**: Reference to another AquaTree
```typescript
{
  fileName: "linked.json",
  fileContent: anotherAquaTree,
  path: "/links/linked.json"
}
```

## Verification Graph

Result of verification includes a graph structure:

```typescript
interface VerificationGraphData {
  hash: string
  previous_verification_hash: string
  timestamp: string
  isValidationSuccessful: boolean
  revisionType: RevisionType
  info: RevisionGraphInfo  // Type-specific details
  verificationGraphData: VerificationGraphData[]      // Children
  linkVerificationGraphData: VerificationGraphData[]  // Links
}
```

### Traversing the Graph

```typescript
function printVerification(graph: VerificationGraphData, depth = 0) {
  const indent = "  ".repeat(depth);
  const status = graph.isValidationSuccessful ? "" : "";
  console.log(`${indent}${status} ${graph.revisionType} (${graph.hash.slice(0, 10)}...)`);

  // Traverse children
  graph.verificationGraphData.forEach(child => {
    printVerification(child, depth + 1);
  });

  // Traverse links
  graph.linkVerificationGraphData.forEach(link => {
    console.log(`${indent}  ï¿½ Linked:`);
    printVerification(link, depth + 2);
  });
}
```

## Credentials

Configuration for signing and witnessing:

```typescript
interface CredentialsData {
  mnemonic: string             // BIP39 mnemonic for CLI signing
  nostr_sk: string             // Nostr secret key
  did_key: string              // DID key for DID signing
  alchemy_key: string          // Alchemy API key for verification
  witness_eth_network: string  // "mainnet", "sepolia", "holesky"
  witness_method: string       // "cli" or "metamask"
  p12_password?: string        // P12 certificate password
  p12_content?: string         // P12 certificate content
}
```

## Logging

V3 uses typed logging throughout:

```typescript
enum LogType {
  SUCCESS = "success",
  INFO = "info",
  ERROR = "error",
  WARNING = "warning",
  HINT = "hint",
  DEBUGDATA = "debug_data",
  // ... revision types with emojis
  FILE = "file",      // =ï¿½
  LINK = "link",      // =
  SIGNATURE = "signature",  // =
  WITNESS = "witness",      // =@
  FORM = "form"            // =ï¿½
}
```

Each operation returns logs for debugging and user feedback.

## Best Practices

### 1. Genesis Patterns

**Single File**:
```
File Genesis ï¿½ Sign ï¿½ Witness
```

**Form Data**:
```
Form Genesis ï¿½ Sign ï¿½ Witness
```

### 2. Update Patterns

**Content Update**:
```
... ï¿½ New File Revision ï¿½ Sign ï¿½ Witness
```

**Multi-Party**:
```
... ï¿½ Sign (Party 1) ï¿½ Sign (Party 2) ï¿½ Witness
```

### 3. Linking Patterns

**Dependencies**:
```
Main Document ï¿½ Link (to dependencies) ï¿½ Sign ï¿½ Witness
```

**Aggregation**:
```
Component 1 
Component 2 ï¿½ Aggregation Link ï¿½ Sign ï¿½ Witness
Component 3 
```

### 4. Verification Patterns

**Full Chain**:
```typescript
const result = await aquafier.verifyRevisionChain(aquaTree);
```

**Specific Revision**:
```typescript
const revision = aquaTree.revisions[specificHash];
// Manually verify hash computation
```

### 5. Storage Patterns

**Database**: Store serialized AquaTree JSON
```typescript
const json = JSON.stringify(aquaTree);
db.save(documentId, json);
```

**File System**: Save as .aqua.json file
```typescript
fs.writeFileSync('document.aqua.json', JSON.stringify(aquaTree, null, 2));
```

## Common Patterns

### Document Lifecycle

```
1. Create ï¿½ File Genesis
2. Review ï¿½ Sign (Reviewer)
3. Approve ï¿½ Sign (Approver)
4. Timestamp ï¿½ Witness (Ethereum)
5. Archive ï¿½ Store AquaTree
6. Verify ï¿½ Check entire chain
```

### Multi-Document Project

```
1. Create each document ï¿½ Individual AquaTrees
2. Link together ï¿½ Link Revision in main tree
3. Sign project ï¿½ Sign main tree
4. Witness ï¿½ Witness main tree
5. All documents timestamped through link
```

## See Also

- [Introduction](/previous_versions/version_3/introduction) - Overview and quick start
- [Tooling](/previous_versions/version_3/tooling) - SDK API reference
- [Schema Reference](/previous_versions/version_3/schema) - Detailed specifications
11:T3875,
# Aqua Protocol v3 Concepts

Understanding the core concepts of Aqua Protocol v3 is essential for effectively using the SDK and building applications. This guide covers the fundamental ideas, terminology, and patterns used throughout the protocol.

## AquaTree

The **AquaTree** is the primary data structure in v3. It represents a complete, self-contained collection of revisions with their relationships and metadata.

### Structure

```typescript
interface AquaTree {
  revisions: Revisions      // All revisions indexed by hash
  file_index: FileIndex     // Maps file hashes to filenames
  tree?: RevisionTree       // Tree structure of revisions
  treeMapping?: TreeMapping // Path mappings for navigation
}
```

### Components

#### 1. Revisions
A flat map of all revisions, keyed by their verification hash:

```typescript
{
  "0xabc123...": {
    previous_verification_hash: "0xdef456...",
    local_timestamp: "2024-01-01T12:00:00",
    revision_type: "file",
    // ... other fields
  },
  "0xdef456...": {
    // ... another revision
  }
}
```

#### 2. File Index
Maps file content hashes to filenames for reference:

```typescript
{
  "0xfile_hash_1": "document.pdf",
  "0xfile_hash_2": "image.png"
}
```

#### 3. Tree Structure (Optional)
Hierarchical representation showing parent-child relationships:

```typescript
{
  hash: "0xabc123...",  // Root revision
  children: [
    {
      hash: "0xdef456...",
      children: [...]
    }
  ]
}
```

#### 4. Tree Mapping (Optional)
Path information for each revision:

```typescript
{
  paths: {
    "0xabc123": ["0xroot", "0xabc123"],
    "0xdef456": ["0xroot", "0xabc123", "0xdef456"]
  },
  latestHash: "0xdef456..."  // Most recent revision
}
```

## Revisions

A **Revision** is a single entry in the AquaTree representing an operation or state change.

### Common Fields

All revisions share these base fields:

| Field | Type | Description |
|-------|------|-------------|
| `previous_verification_hash` | string | Hash linking to previous revision (empty string for genesis) |
| `local_timestamp` | string | ISO 8601 timestamp when revision was created |
| `revision_type` | string | One of: `"file"`, `"form"`, `"signature"`, `"witness"`, `"link"` |
| `version` | string | Protocol version with method: `https://aqua-protocol.org/docs/v3/schema_2 \| SHA256 \| Method: scalar/tree` |

### Genesis Revision

The **genesis revision** is the first revision in a chain:
- `previous_verification_hash` is an empty string `""`
- Typically a file or form revision
- Establishes the initial state

### Verification Hash

Each revision has a unique **verification hash** computed from its canonical form:

```typescript
hash = SHA256(canonicalized_revision_data)
```

This hash serves as:
- Unique identifier for the revision
- Key in the revisions map
- Reference in `previous_verification_hash` fields

## Revision Types

### 1. File Revision

Stores file metadata and optionally content.

**Purpose**: Document file presence and content integrity

**Fields**:
- `file_hash`: SHA256 hash of file content
- `file_nonce`: Random nonce for uniqueness
- `content`: Optional file content (text or binary)
- `leaves`: Array of hashes (tree mode only)

**Example**:
```json
{
  "previous_verification_hash": "",
  "local_timestamp": "2024-01-01T12:00:00",
  "revision_type": "file",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "file_hash": "0x9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08",
  "file_nonce": "0x3fa8b1c2d3e4f5a67b8c9d0e1f2a3b4c"
}
```

### 2. Form Revision

Stores structured key-value data.

**Purpose**: Capture form submissions, structured data, or metadata

**Fields**:
- `file_hash`: Hash of form data
- `file_nonce`: Random nonce
- `content`: Form data as key-value object
- `leaves`: Array of hashes (tree mode only)

**Example**:
```json
{
  "previous_verification_hash": "",
  "local_timestamp": "2024-01-01T12:00:00",
  "revision_type": "form",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: tree",
  "file_hash": "0xabc123...",
  "file_nonce": "0x123abc...",
  "content": {
    "name": "John Doe",
    "email": "john@example.com",
    "status": "approved"
  },
  "leaves": ["0x...", "0x...", "0x..."]
}
```

### 3. Signature Revision

Adds cryptographic signature to prove authenticity.

**Purpose**: Authenticate revisions and establish authorship

**Fields**:
- `signature`: Signature value (format depends on type)
- `signature_type`: One of `"cli"`, `"metamask"`, `"did"`, `"p12"`, `"inline"`
- `signature_wallet_address`: Ethereum address (for cli/metamask)
- `signature_public_key`: Public key (for p12)

**Example (MetaMask)**:
```json
{
  "previous_verification_hash": "0xabc123...",
  "local_timestamp": "2024-01-01T12:01:00",
  "revision_type": "signature",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "signature_type": "metamask",
  "signature": "0x8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f...",
  "signature_wallet_address": "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb8"
}
```

**Example (DID)**:
```json
{
  "previous_verification_hash": "0xabc123...",
  "local_timestamp": "2024-01-01T12:01:00",
  "revision_type": "signature",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "signature_type": "did",
  "signature": {
    "payload": "eyJhbGciOi...",
    "signatures": [{
      "protected": "eyJhbGci...",
      "signature": "..."
    }]
  }
}
```

### 4. Witness Revision

Anchors revision to external timestamping service.

**Purpose**: Prove existence at specific time via blockchain or TSA

**Fields**:
- `witness_merkle_root`: Root hash of Merkle tree
- `witness_timestamp`: Unix timestamp from witness service
- `witness_network`: Network used (`"mainnet"`, `"sepolia"`, `"holesky"`, `"tsa"`, `"nostr"`)
- `witness_smart_contract_address`: Contract address (Ethereum)
- `witness_transaction_hash`: Transaction hash
- `witness_sender_account_address`: Account that witnessed
- `witness_merkle_proof`: Merkle proof array

**Example (Ethereum)**:
```json
{
  "previous_verification_hash": "0xabc123...",
  "local_timestamp": "2024-01-01T12:02:00",
  "revision_type": "witness",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "witness_merkle_root": "0xdef456...",
  "witness_timestamp": 1704110520,
  "witness_network": "sepolia",
  "witness_smart_contract_address": "0x5FbDB2315678afecb367f032d93F642f64180aa3",
  "witness_transaction_hash": "0x9f86d081...",
  "witness_sender_account_address": "0x742d35Cc...",
  "witness_merkle_proof": []
}
```

### 5. Link Revision

Connects to other AquaTree chains.

**Purpose**: Establish relationships between separate chains

**Fields**:
- `link_type`: Type of link relationship (application-specific)
- `link_verification_hashes`: Array of hashes from other chains
- `link_file_hashes`: Array of corresponding file hashes

**Example**:
```json
{
  "previous_verification_hash": "0xabc123...",
  "local_timestamp": "2024-01-01T12:03:00",
  "revision_type": "link",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "link_type": "dependency",
  "link_verification_hashes": [
    "0x111...",
    "0x222...",
    "0x333..."
  ],
  "link_file_hashes": [
    "0xaaa...",
    "0xbbb...",
    "0xccc..."
  ]
}
```

## Methods: Scalar vs Tree

V3 supports two canonicalization methods, specified in the version string.

### Scalar Method

**Format**: `Method: scalar`

**How it works**:
- Revision is serialized as-is
- Hash computed directly from canonical JSON
- Simple, straightforward

**When to use**:
- Small revisions
- Simple file/form data
- Quick operations

**Example**:
```typescript
version: "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar"
// No leaves field
```

### Tree Method

**Format**: `Method: tree`

**How it works**:
- Content broken into key-value leaves
- Each leaf hashed individually
- Merkle tree constructed from leaves
- Root becomes the verification hash

**When to use**:
- Large files or forms
- Selective disclosure needed
- Proof of specific fields

**Example**:
```typescript
version: "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: tree"
leaves: [
  "0xhash_of_key_value_1",
  "0xhash_of_key_value_2",
  "0xhash_of_key_value_3"
]
```

**Leaf Generation**:
```typescript
// For form data: { "name": "John", "email": "john@example.com" }
leaves = [
  SHA256("name:John"),
  SHA256("email:john@example.com")
]
```

## Chains and Trees

### Linear Chain

Simple sequence of revisions:

```
Genesis ï¿½ Signature ï¿½ Witness ï¿½ Update ï¿½ Signature ï¿½ Witness
```

Each revision references the previous one.

### Branching Tree

Multiple paths from a common ancestor:

```
            Genesis
               ï¿½
          Signature
             /  \
        Branch A  Branch B
           ï¿½        ï¿½
        Update 1  Update 2
```

V3 supports branching, allowing parallel development paths.

### Path Mapping

The `treeMapping` provides paths to each revision:

```typescript
{
  paths: {
    "genesis_hash": ["genesis_hash"],
    "sig_hash": ["genesis_hash", "sig_hash"],
    "branch_a_hash": ["genesis_hash", "sig_hash", "branch_a_hash"],
    "branch_b_hash": ["genesis_hash", "sig_hash", "branch_b_hash"]
  },
  latestHash: "branch_a_hash"  // Longest path
}
```

## File Object

Input format for creating revisions:

```typescript
interface FileObject {
  fileName: string           // Display name
  fileContent: string |      // Text content
                AquaTree |   // Linked tree
                Uint8Array | // Binary data
                Record<string, string> | // Form data
                object       // Structured data
  path: string              // File path
  fileSize?: number         // Size in bytes
}
```

### Content Types

**Text**: Plain text, HTML, JSON
```typescript
{
  fileName: "doc.txt",
  fileContent: "Hello World",
  path: "/docs/doc.txt"
}
```

**Binary**: Images, PDFs, any binary file
```typescript
{
  fileName: "image.png",
  fileContent: new Uint8Array([...]),
  path: "/images/image.png"
}
```

**Form**: Key-value structured data
```typescript
{
  fileName: "form.json",
  fileContent: {
    "field1": "value1",
    "field2": "value2"
  },
  path: "/forms/form.json"
}
```

**Link**: Reference to another AquaTree
```typescript
{
  fileName: "linked.json",
  fileContent: anotherAquaTree,
  path: "/links/linked.json"
}
```

## Verification Graph

Result of verification includes a graph structure:

```typescript
interface VerificationGraphData {
  hash: string
  previous_verification_hash: string
  timestamp: string
  isValidationSuccessful: boolean
  revisionType: RevisionType
  info: RevisionGraphInfo  // Type-specific details
  verificationGraphData: VerificationGraphData[]      // Children
  linkVerificationGraphData: VerificationGraphData[]  // Links
}
```

### Traversing the Graph

```typescript
function printVerification(graph: VerificationGraphData, depth = 0) {
  const indent = "  ".repeat(depth);
  const status = graph.isValidationSuccessful ? "" : "";
  console.log(`${indent}${status} ${graph.revisionType} (${graph.hash.slice(0, 10)}...)`);

  // Traverse children
  graph.verificationGraphData.forEach(child => {
    printVerification(child, depth + 1);
  });

  // Traverse links
  graph.linkVerificationGraphData.forEach(link => {
    console.log(`${indent}  ï¿½ Linked:`);
    printVerification(link, depth + 2);
  });
}
```

## Credentials

Configuration for signing and witnessing:

```typescript
interface CredentialsData {
  mnemonic: string             // BIP39 mnemonic for CLI signing
  nostr_sk: string             // Nostr secret key
  did_key: string              // DID key for DID signing
  alchemy_key: string          // Alchemy API key for verification
  witness_eth_network: string  // "mainnet", "sepolia", "holesky"
  witness_method: string       // "cli" or "metamask"
  p12_password?: string        // P12 certificate password
  p12_content?: string         // P12 certificate content
}
```

## Logging

V3 uses typed logging throughout:

```typescript
enum LogType {
  SUCCESS = "success",
  INFO = "info",
  ERROR = "error",
  WARNING = "warning",
  HINT = "hint",
  DEBUGDATA = "debug_data",
  // ... revision types with emojis
  FILE = "file",      // =ï¿½
  LINK = "link",      // =
  SIGNATURE = "signature",  // =
  WITNESS = "witness",      // =@
  FORM = "form"            // =ï¿½
}
```

Each operation returns logs for debugging and user feedback.

## Best Practices

### 1. Genesis Patterns

**Single File**:
```
File Genesis ï¿½ Sign ï¿½ Witness
```

**Form Data**:
```
Form Genesis ï¿½ Sign ï¿½ Witness
```

### 2. Update Patterns

**Content Update**:
```
... ï¿½ New File Revision ï¿½ Sign ï¿½ Witness
```

**Multi-Party**:
```
... ï¿½ Sign (Party 1) ï¿½ Sign (Party 2) ï¿½ Witness
```

### 3. Linking Patterns

**Dependencies**:
```
Main Document ï¿½ Link (to dependencies) ï¿½ Sign ï¿½ Witness
```

**Aggregation**:
```
Component 1 
Component 2 ï¿½ Aggregation Link ï¿½ Sign ï¿½ Witness
Component 3 
```

### 4. Verification Patterns

**Full Chain**:
```typescript
const result = await aquafier.verifyRevisionChain(aquaTree);
```

**Specific Revision**:
```typescript
const revision = aquaTree.revisions[specificHash];
// Manually verify hash computation
```

### 5. Storage Patterns

**Database**: Store serialized AquaTree JSON
```typescript
const json = JSON.stringify(aquaTree);
db.save(documentId, json);
```

**File System**: Save as .aqua.json file
```typescript
fs.writeFileSync('document.aqua.json', JSON.stringify(aquaTree, null, 2));
```

## Common Patterns

### Document Lifecycle

```
1. Create ï¿½ File Genesis
2. Review ï¿½ Sign (Reviewer)
3. Approve ï¿½ Sign (Approver)
4. Timestamp ï¿½ Witness (Ethereum)
5. Archive ï¿½ Store AquaTree
6. Verify ï¿½ Check entire chain
```

### Multi-Document Project

```
1. Create each document ï¿½ Individual AquaTrees
2. Link together ï¿½ Link Revision in main tree
3. Sign project ï¿½ Sign main tree
4. Witness ï¿½ Witness main tree
5. All documents timestamped through link
```

## See Also

- [Introduction](/previous_versions/version_3/introduction) - Overview and quick start
- [Tooling](/previous_versions/version_3/tooling) - SDK API reference
- [Schema Reference](/previous_versions/version_3/schema) - Detailed specifications
12:T2045,
# Aqua Protocol v3

Aqua Protocol v3 is a mature version of the protocol with a comprehensive JavaScript/TypeScript SDK. It provides a robust framework for creating verifiable revision chains with support for files, forms, signatures, witnesses, and links.

## Overview

Version 3 represents a stable, production-ready implementation of the Aqua Protocol specifically designed for JavaScript/TypeScript environments. It offers:

- **Cross-Platform Support**: Node.js, Web browsers, and React Native
- **Type Safety**: Full TypeScript support with comprehensive type definitions
- **Flexible Revision Types**: File, Form, Signature, Witness, and Link revisions
- **Multiple Signing Methods**: CLI, MetaMask, DID, and P12 certificate signing
- **Multi-Network Witnessing**: Ethereum (mainnet, Sepolia, Holesky), Nostr, and TSA
- **Tree Structure**: Native support for revision trees and path mapping

## Version Identifier

```
https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar/tree
```

## Core Components

### AquaTree Structure

The AquaTree is the core data structure in v3:

```typescript
interface AquaTree {
  revisions: Revisions      // Map of revision hash to revision data
  file_index: FileIndex     // Map of file hash to filename
  tree?: RevisionTree       // Tree structure representation
  treeMapping?: TreeMapping // Path mappings for navigation
}
```

### Revision Types

V3 supports five types of revisions:

1. **File Revision** - Store file metadata and content hashes
2. **Form Revision** - Store structured form data with key-value pairs
3. **Signature Revision** - Add cryptographic signatures
4. **Witness Revision** - Timestamp via blockchain or TSA
5. **Link Revision** - Connect to other AquaTree chains

## Key Features

### 1. Dual Mode Support

**Scalar Mode**: Direct hash computation
```typescript
version: "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar"
```

**Tree Mode**: Merkle tree-based with leaves
```typescript
version: "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: tree"
leaves: ["hash1", "hash2", "hash3", ...]
```

### 2. Platform Flexibility

```typescript
// Node.js
import Aquafier from 'aqua-js-sdk';

// Web Browser
import Aquafier from 'aqua-js-sdk/web';

// React Native
import Aquafier from 'aqua-js-sdk/react-native';
```

### 3. Comprehensive Signing

- **CLI Signing**: Uses mnemonic phrase
- **MetaMask**: Browser extension integration
- **DID**: Decentralized identifiers with JWS
- **P12**: Certificate-based signing
- **Inline**: Pre-computed signatures

### 4. Multi-Network Witnessing

- **Ethereum**: Mainnet, Sepolia, Holesky testnets
- **Nostr**: Decentralized social network
- **TSA**: RFC 3161 timestamp authorities

### 5. Content Flexibility

File content can be:
- **Text**: HTML, plain text, JSON
- **Binary**: Images, PDFs, any file type (as Uint8Array)
- **Forms**: Key-value structured data
- **Links**: References to other AquaTrees

## Quick Start Example

```typescript
import Aquafier, { FileObject } from 'aqua-js-sdk';

// Initialize Aquafier
const aquafier = new Aquafier();

// Create file object
const fileObject: FileObject = {
  fileName: "document.txt",
  fileContent: "Important document content",
  path: "/documents/document.txt"
};

// Create genesis revision
const result = await aquafier.createGenesisRevision(fileObject);

if (result.isErr) {
  console.error("Error creating revision");
  result.logs.forEach(log => console.log(log));
  return;
}

// Access the AquaTree
const aquaTree = result.data.aquaTree;

// Sign the revision
const signResult = await aquafier.signRevision(
  aquaTree,
  "cli",  // or "metamask", "did", "p12"
  credentials
);

// Witness to blockchain
const witnessResult = await aquafier.witnessRevision(
  signResult.data.aquaTree,
  "eth",  // or "nostr", "tsa"
  witnessConfig
);

// Save aquaTree JSON for storage/transmission
const json = JSON.stringify(witnessResult.data.aquaTree);
```

## Architecture

### Revision Chain Structure

```
Genesis Revision (File/Form)
    â†“ previous_verification_hash
Signature Revision
    â†“ previous_verification_hash
Witness Revision
    â†“ previous_verification_hash
New Content Revision
    â†“ previous_verification_hash
...
```

### Tree Branching

V3 supports tree structures for branching revisions:

```
        Genesis
           â†“
      Signature
         /  \
    Branch A  Branch B
       â†“        â†“
    Update 1  Update 2
```

## Common Fields

All revisions share these core fields:

| Field | Type | Description |
|-------|------|-------------|
| `previous_verification_hash` | string | Hash of previous revision (empty for genesis) |
| `local_timestamp` | string | ISO 8601 timestamp |
| `revision_type` | string | Type: `"file"`, `"form"`, `"signature"`, `"witness"`, `"link"` |
| `version` | string | Protocol version and method identifier |

## Installation

```bash
npm install aqua-js-sdk
```

### Requirements

- Node.js v20.9.0 or later
- TypeScript 5.3+ (optional, for type checking)

### Peer Dependencies

- `ethers` ^6.7.1 (for Ethereum operations)
- `react-native-fs` (optional, for React Native)
- `@react-native-async-storage/async-storage` (optional, for React Native)

## Use Cases

### Document Notarization
```
Document â†’ Sign (Author) â†’ Witness (Ethereum) â†’ Verifiable Proof
```

### Form Data Accountability
```
Form Submission â†’ Sign (User) â†’ Witness â†’ Audit Trail
```

### Multi-Party Approval
```
Document â†’ Sign (Party 1) â†’ Sign (Party 2) â†’ Witness â†’ Approved
```

### Supply Chain Tracking
```
Event 1 â†’ Link to Event 2 â†’ Link to Event 3 â†’ Complete Chain
```

### Content Versioning
```
Version 1 â†’ Update â†’ Version 2 â†’ Update â†’ Version 3 â†’ History
```

## Verification

V3 includes comprehensive verification capabilities:

```typescript
// Verify entire chain
const verification = await aquafier.verifyRevisionChain(aquaTree);

// Check results
verification.verificationGraphData.forEach(node => {
  console.log(`${node.revisionType}: ${node.isValidationSuccessful ? 'âœ“' : 'âœ—'}`);
});
```

## Key Differences from v4

| Feature | v3 | v4 |
|---------|----|----|
| Language | JavaScript/TypeScript | Rust (with WASM support) |
| Template System | No formal templates | Template revisions with JSON Schema |
| Signature Types | 4 types (CLI, MetaMask, DID, P12) | 3 types (RSA, EIP-191, DID:JWS) |
| Version Format | URL with embedded method | URL only, method as field |
| Form Support | Native form revision type | Forms as object revisions with templates |
| Platform Focus | Web/Node.js/React Native | Cross-platform with WASM |

## Migration Considerations

### From v3 to v4

- **Breaking Changes**: Schema structure differs significantly
- **No Direct Migration**: v3 and v4 chains are not directly compatible
- **Use Case**: Continue using v3 for JavaScript-first projects
- **Future**: v4 offers more structure and cross-platform consistency

### When to Use v3

- Existing JavaScript/TypeScript projects
- React Native applications
- Need for form revision type
- Mature, stable implementation required
- Quick prototyping and development

### When to Use v4

- New projects requiring maximum interoperability
- Need for formal schema validation
- Rust or multi-language environments
- WASM compilation for web
- Template-based data structures

## Community and Support

- **GitHub**: [aqua-verifier-js-lib](https://github.com/inblockio/aqua-verifier-js-lib)
- **Issues**: Report bugs and request features on GitHub
- **Documentation**: Examples in `/examples` directory

## Next Steps

- [Concepts](/previous_versions/version_3/concepts) - Core concepts and terminology
- [Tooling](/previous_versions/version_3/tooling) - SDK usage and API reference
- [Schema Reference](/previous_versions/version_3/schema) - Detailed revision specifications
- [Examples](https://github.com/inblockio/aqua-verifier-js-lib/tree/main/examples) - Code examples

## Version History

- **3.2.1**: Current stable release
- **3.2.0**: React Native support added
- **3.1.x**: Performance improvements
- **3.0.0**: Major release with TypeScript rewrite

For detailed changelog, see the [GitHub releases](https://github.com/inblockio/aqua-verifier-js-lib/releases).
13:T2045,
# Aqua Protocol v3

Aqua Protocol v3 is a mature version of the protocol with a comprehensive JavaScript/TypeScript SDK. It provides a robust framework for creating verifiable revision chains with support for files, forms, signatures, witnesses, and links.

## Overview

Version 3 represents a stable, production-ready implementation of the Aqua Protocol specifically designed for JavaScript/TypeScript environments. It offers:

- **Cross-Platform Support**: Node.js, Web browsers, and React Native
- **Type Safety**: Full TypeScript support with comprehensive type definitions
- **Flexible Revision Types**: File, Form, Signature, Witness, and Link revisions
- **Multiple Signing Methods**: CLI, MetaMask, DID, and P12 certificate signing
- **Multi-Network Witnessing**: Ethereum (mainnet, Sepolia, Holesky), Nostr, and TSA
- **Tree Structure**: Native support for revision trees and path mapping

## Version Identifier

```
https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar/tree
```

## Core Components

### AquaTree Structure

The AquaTree is the core data structure in v3:

```typescript
interface AquaTree {
  revisions: Revisions      // Map of revision hash to revision data
  file_index: FileIndex     // Map of file hash to filename
  tree?: RevisionTree       // Tree structure representation
  treeMapping?: TreeMapping // Path mappings for navigation
}
```

### Revision Types

V3 supports five types of revisions:

1. **File Revision** - Store file metadata and content hashes
2. **Form Revision** - Store structured form data with key-value pairs
3. **Signature Revision** - Add cryptographic signatures
4. **Witness Revision** - Timestamp via blockchain or TSA
5. **Link Revision** - Connect to other AquaTree chains

## Key Features

### 1. Dual Mode Support

**Scalar Mode**: Direct hash computation
```typescript
version: "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar"
```

**Tree Mode**: Merkle tree-based with leaves
```typescript
version: "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: tree"
leaves: ["hash1", "hash2", "hash3", ...]
```

### 2. Platform Flexibility

```typescript
// Node.js
import Aquafier from 'aqua-js-sdk';

// Web Browser
import Aquafier from 'aqua-js-sdk/web';

// React Native
import Aquafier from 'aqua-js-sdk/react-native';
```

### 3. Comprehensive Signing

- **CLI Signing**: Uses mnemonic phrase
- **MetaMask**: Browser extension integration
- **DID**: Decentralized identifiers with JWS
- **P12**: Certificate-based signing
- **Inline**: Pre-computed signatures

### 4. Multi-Network Witnessing

- **Ethereum**: Mainnet, Sepolia, Holesky testnets
- **Nostr**: Decentralized social network
- **TSA**: RFC 3161 timestamp authorities

### 5. Content Flexibility

File content can be:
- **Text**: HTML, plain text, JSON
- **Binary**: Images, PDFs, any file type (as Uint8Array)
- **Forms**: Key-value structured data
- **Links**: References to other AquaTrees

## Quick Start Example

```typescript
import Aquafier, { FileObject } from 'aqua-js-sdk';

// Initialize Aquafier
const aquafier = new Aquafier();

// Create file object
const fileObject: FileObject = {
  fileName: "document.txt",
  fileContent: "Important document content",
  path: "/documents/document.txt"
};

// Create genesis revision
const result = await aquafier.createGenesisRevision(fileObject);

if (result.isErr) {
  console.error("Error creating revision");
  result.logs.forEach(log => console.log(log));
  return;
}

// Access the AquaTree
const aquaTree = result.data.aquaTree;

// Sign the revision
const signResult = await aquafier.signRevision(
  aquaTree,
  "cli",  // or "metamask", "did", "p12"
  credentials
);

// Witness to blockchain
const witnessResult = await aquafier.witnessRevision(
  signResult.data.aquaTree,
  "eth",  // or "nostr", "tsa"
  witnessConfig
);

// Save aquaTree JSON for storage/transmission
const json = JSON.stringify(witnessResult.data.aquaTree);
```

## Architecture

### Revision Chain Structure

```
Genesis Revision (File/Form)
    â†“ previous_verification_hash
Signature Revision
    â†“ previous_verification_hash
Witness Revision
    â†“ previous_verification_hash
New Content Revision
    â†“ previous_verification_hash
...
```

### Tree Branching

V3 supports tree structures for branching revisions:

```
        Genesis
           â†“
      Signature
         /  \
    Branch A  Branch B
       â†“        â†“
    Update 1  Update 2
```

## Common Fields

All revisions share these core fields:

| Field | Type | Description |
|-------|------|-------------|
| `previous_verification_hash` | string | Hash of previous revision (empty for genesis) |
| `local_timestamp` | string | ISO 8601 timestamp |
| `revision_type` | string | Type: `"file"`, `"form"`, `"signature"`, `"witness"`, `"link"` |
| `version` | string | Protocol version and method identifier |

## Installation

```bash
npm install aqua-js-sdk
```

### Requirements

- Node.js v20.9.0 or later
- TypeScript 5.3+ (optional, for type checking)

### Peer Dependencies

- `ethers` ^6.7.1 (for Ethereum operations)
- `react-native-fs` (optional, for React Native)
- `@react-native-async-storage/async-storage` (optional, for React Native)

## Use Cases

### Document Notarization
```
Document â†’ Sign (Author) â†’ Witness (Ethereum) â†’ Verifiable Proof
```

### Form Data Accountability
```
Form Submission â†’ Sign (User) â†’ Witness â†’ Audit Trail
```

### Multi-Party Approval
```
Document â†’ Sign (Party 1) â†’ Sign (Party 2) â†’ Witness â†’ Approved
```

### Supply Chain Tracking
```
Event 1 â†’ Link to Event 2 â†’ Link to Event 3 â†’ Complete Chain
```

### Content Versioning
```
Version 1 â†’ Update â†’ Version 2 â†’ Update â†’ Version 3 â†’ History
```

## Verification

V3 includes comprehensive verification capabilities:

```typescript
// Verify entire chain
const verification = await aquafier.verifyRevisionChain(aquaTree);

// Check results
verification.verificationGraphData.forEach(node => {
  console.log(`${node.revisionType}: ${node.isValidationSuccessful ? 'âœ“' : 'âœ—'}`);
});
```

## Key Differences from v4

| Feature | v3 | v4 |
|---------|----|----|
| Language | JavaScript/TypeScript | Rust (with WASM support) |
| Template System | No formal templates | Template revisions with JSON Schema |
| Signature Types | 4 types (CLI, MetaMask, DID, P12) | 3 types (RSA, EIP-191, DID:JWS) |
| Version Format | URL with embedded method | URL only, method as field |
| Form Support | Native form revision type | Forms as object revisions with templates |
| Platform Focus | Web/Node.js/React Native | Cross-platform with WASM |

## Migration Considerations

### From v3 to v4

- **Breaking Changes**: Schema structure differs significantly
- **No Direct Migration**: v3 and v4 chains are not directly compatible
- **Use Case**: Continue using v3 for JavaScript-first projects
- **Future**: v4 offers more structure and cross-platform consistency

### When to Use v3

- Existing JavaScript/TypeScript projects
- React Native applications
- Need for form revision type
- Mature, stable implementation required
- Quick prototyping and development

### When to Use v4

- New projects requiring maximum interoperability
- Need for formal schema validation
- Rust or multi-language environments
- WASM compilation for web
- Template-based data structures

## Community and Support

- **GitHub**: [aqua-verifier-js-lib](https://github.com/inblockio/aqua-verifier-js-lib)
- **Issues**: Report bugs and request features on GitHub
- **Documentation**: Examples in `/examples` directory

## Next Steps

- [Concepts](/previous_versions/version_3/concepts) - Core concepts and terminology
- [Tooling](/previous_versions/version_3/tooling) - SDK usage and API reference
- [Schema Reference](/previous_versions/version_3/schema) - Detailed revision specifications
- [Examples](https://github.com/inblockio/aqua-verifier-js-lib/tree/main/examples) - Code examples

## Version History

- **3.2.1**: Current stable release
- **3.2.0**: React Native support added
- **3.1.x**: Performance improvements
- **3.0.0**: Major release with TypeScript rewrite

For detailed changelog, see the [GitHub releases](https://github.com/inblockio/aqua-verifier-js-lib/releases).
14:T45aa,
# Aqua Protocol v3 - Schema Reference

This document provides comprehensive technical specifications for all revision types in Aqua Protocol v3. Each revision type has specific fields and validation rules.

## Version String Format

```
https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: {scalar|tree}
```

**Components:**
- Protocol URL: `https://aqua-protocol.org/docs/v3/schema_2`
- Hash Algorithm: `SHA256`
- Canonicalization Method: `scalar` or `tree`

## Common Fields

All revisions share these mandatory fields:

| Field | Type | Description | Validation |
|-------|------|-------------|------------|
| `previous_verification_hash` | string | Hash of previous revision | Empty string for genesis, otherwise 64-char hex with `0x` prefix |
| `local_timestamp` | string | ISO 8601 timestamp | Valid ISO 8601 format: `YYYY-MM-DDTHH:mm:ss` |
| `revision_type` | string | Type of revision | One of: `"file"`, `"form"`, `"signature"`, `"witness"`, `"link"` |
| `version` | string | Protocol version and method | Must match format above |

---

## File Revision

Represents a file with metadata and optional content.

### Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `previous_verification_hash` | string | Yes | Previous revision hash (empty for genesis) |
| `local_timestamp` | string | Yes | ISO 8601 timestamp |
| `revision_type` | string | Yes | Must be `"file"` |
| `version` | string | Yes | Protocol version string |
| `file_hash` | string | Yes | SHA256 hash of file content (hex with `0x`) |
| `file_nonce` | string | Yes | Random 16-byte nonce (hex with `0x`) |
| `content` | string/Uint8Array | No | Optional file content |
| `leaves` | string[] | Conditional | Required if `Method: tree`, array of leaf hashes |

### Genesis File Revision (Scalar)

```json
{
  "previous_verification_hash": "",
  "local_timestamp": "2024-01-01T12:00:00",
  "revision_type": "file",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "file_hash": "0x9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08",
  "file_nonce": "0x3fa8b1c2d3e4f5a67b8c9d0e1f2a3b4c"
}
```

### Genesis File Revision (Tree)

```json
{
  "previous_verification_hash": "",
  "local_timestamp": "2024-01-01T12:00:00",
  "revision_type": "file",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: tree",
  "file_hash": "0x9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08",
  "file_nonce": "0x3fa8b1c2d3e4f5a67b8c9d0e1f2a3b4c",
  "leaves": [
    "0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef",
    "0xabcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890"
  ]
}
```

### With Content

```json
{
  "previous_verification_hash": "",
  "local_timestamp": "2024-01-01T12:00:00",
  "revision_type": "file",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "file_hash": "0x9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08",
  "file_nonce": "0x3fa8b1c2d3e4f5a67b8c9d0e1f2a3b4c",
  "content": "This is the file content as a string"
}
```

### Validation Rules

1. `file_hash` must match SHA256 of file content
2. `file_nonce` must be exactly 16 bytes (32 hex chars + `0x`)
3. If `Method: tree`, `leaves` array must be present
4. If `Method: scalar`, `leaves` must be absent
5. `content` is optional but if present, hash must match `file_hash`

---

## Form Revision

Stores structured key-value data.

### Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `previous_verification_hash` | string | Yes | Previous revision hash (empty for genesis) |
| `local_timestamp` | string | Yes | ISO 8601 timestamp |
| `revision_type` | string | Yes | Must be `"form"` |
| `version` | string | Yes | Protocol version string |
| `file_hash` | string | Yes | SHA256 hash of form data |
| `file_nonce` | string | Yes | Random 16-byte nonce |
| `content` | object | Yes | Form data as key-value pairs |
| `leaves` | string[] | Conditional | Required if `Method: tree` |

### Example (Scalar)

```json
{
  "previous_verification_hash": "",
  "local_timestamp": "2024-01-01T12:00:00",
  "revision_type": "form",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "file_hash": "0xabc123def456...",
  "file_nonce": "0x7c8d9e0f1a2b3c4d5e6f7a8b9c0d1e2f",
  "content": {
    "name": "John Doe",
    "email": "john@example.com",
    "organization": "Example Corp",
    "role": "Developer"
  }
}
```

### Example (Tree)

```json
{
  "previous_verification_hash": "",
  "local_timestamp": "2024-01-01T12:00:00",
  "revision_type": "form",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: tree",
  "file_hash": "0xabc123def456...",
  "file_nonce": "0x7c8d9e0f1a2b3c4d5e6f7a8b9c0d1e2f",
  "content": {
    "name": "John Doe",
    "email": "john@example.com",
    "organization": "Example Corp",
    "role": "Developer"
  },
  "leaves": [
    "0x...",  // SHA256("name:John Doe")
    "0x...",  // SHA256("email:john@example.com")
    "0x...",  // SHA256("organization:Example Corp")
    "0x..."   // SHA256("role:Developer")
  ]
}
```

### Leaf Computation (Tree Mode)

For each key-value pair in `content`:
```typescript
leaf_hash = SHA256(`${key}:${value}`)
```

### Validation Rules

1. `content` must be a valid JSON object
2. All values in `content` must be strings
3. `file_hash` must match hash of canonicalized content
4. If `Method: tree`, number of leaves must match number of keys in content

---

## Signature Revision

Adds cryptographic signature to verify authenticity.

### Common Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `previous_verification_hash` | string | Yes | Hash of revision being signed |
| `local_timestamp` | string | Yes | ISO 8601 timestamp |
| `revision_type` | string | Yes | Must be `"signature"` |
| `version` | string | Yes | Protocol version string |
| `signature_type` | string | Yes | Type: `"cli"`, `"metamask"`, `"did"`, `"p12"`, `"inline"` |

### CLI / MetaMask Signature

**Additional Fields:**
| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `signature` | string | Yes | Hex-encoded signature (65 bytes for ECDSA) |
| `signature_wallet_address` | string | Yes | Ethereum address (EIP-55 checksummed) |

**Example:**
```json
{
  "previous_verification_hash": "0xabc123...",
  "local_timestamp": "2024-01-01T12:01:00",
  "revision_type": "signature",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "signature_type": "cli",
  "signature": "0x8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2c3d4e5f6a7b8c9d1c",
  "signature_wallet_address": "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb8"
}
```

### DID Signature

**Additional Fields:**
| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `signature` | object | Yes | JWS (JSON Web Signature) object |

**Signature Object Structure:**
```typescript
{
  payload: string;       // Base64url-encoded payload
  signatures: [{
    protected: string;   // Base64url-encoded protected header
    signature: string;   // Base64url-encoded signature
  }]
}
```

**Example:**
```json
{
  "previous_verification_hash": "0xabc123...",
  "local_timestamp": "2024-01-01T12:01:00",
  "revision_type": "signature",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "signature_type": "did",
  "signature": {
    "payload": "eyJhbGciOiJFZERTQSIsImI2NCI6ZmFsc2UsImNyaXQiOlsiYjY0Il19",
    "signatures": [{
      "protected": "eyJhbGciOiJFZERTQSJ9",
      "signature": "kKvXJ_qjJRtGQFLpRvQlCdXMFD8sSE4DTlbMmLqg0BJ9FQKLHvX7y_z5Pr8u0xT8D2vCj9qL1KzN4rP2MzKfBQ"
    }]
  }
}
```

### P12 Certificate Signature

**Additional Fields:**
| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `signature` | string | Yes | Hex-encoded signature |
| `signature_public_key` | string | Yes | Hex-encoded DER public key |

**Example:**
```json
{
  "previous_verification_hash": "0xabc123...",
  "local_timestamp": "2024-01-01T12:01:00",
  "revision_type": "signature",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "signature_type": "p12",
  "signature": "0x...",
  "signature_public_key": "0x308201a2300d06092a864886f70d01010105000382018f..."
}
```

### Inline Signature

Same as CLI/MetaMask but with pre-computed signature.

### Validation Rules

1. Signature must be verifiable using provided credentials
2. For CLI/MetaMask: Address must be recoverable from signature
3. For DID: JWS must be valid and verifiable
4. For P12: Signature must verify with public key
5. Signature must be computed over `previous_verification_hash`

---

## Witness Revision

Anchors revision to blockchain or timestamping service.

### Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `previous_verification_hash` | string | Yes | Hash being witnessed |
| `local_timestamp` | string | Yes | ISO 8601 timestamp |
| `revision_type` | string | Yes | Must be `"witness"` |
| `version` | string | Yes | Protocol version string |
| `witness_merkle_root` | string | Yes | Root hash of Merkle tree |
| `witness_timestamp` | number | Yes | Unix timestamp from witness service |
| `witness_network` | string | Yes | Network: `"mainnet"`, `"sepolia"`, `"holesky"`, `"tsa"`, `"nostr"` |
| `witness_smart_contract_address` | string | Conditional | Required for Ethereum |
| `witness_transaction_hash` | string | Yes | Transaction or event hash |
| `witness_sender_account_address` | string | Conditional | Required for Ethereum |
| `witness_merkle_proof` | string[] | Yes | Merkle proof (empty for single witness) |

### Ethereum Witness Example

```json
{
  "previous_verification_hash": "0xabc123...",
  "local_timestamp": "2024-01-01T12:02:00",
  "revision_type": "witness",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "witness_merkle_root": "0xdef456...",
  "witness_timestamp": 1704110520,
  "witness_network": "sepolia",
  "witness_smart_contract_address": "0x5FbDB2315678afecb367f032d93F642f64180aa3",
  "witness_transaction_hash": "0x9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08",
  "witness_sender_account_address": "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb8",
  "witness_merkle_proof": []
}
```

### Batched Witness Example

Multiple revisions witnessed in single transaction:

```json
{
  "previous_verification_hash": "0xabc123...",
  "local_timestamp": "2024-01-01T12:02:00",
  "revision_type": "witness",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "witness_merkle_root": "0xroot...",
  "witness_timestamp": 1704110520,
  "witness_network": "mainnet",
  "witness_smart_contract_address": "0x5FbDB2315678afecb367f032d93F642f64180aa3",
  "witness_transaction_hash": "0x9f86d081...",
  "witness_sender_account_address": "0x742d35Cc...",
  "witness_merkle_proof": [
    "0xsibling_hash_1",
    "0xsibling_hash_2",
    "0xsibling_hash_3"
  ]
}
```

### Nostr Witness Example

```json
{
  "previous_verification_hash": "0xabc123...",
  "local_timestamp": "2024-01-01T12:02:00",
  "revision_type": "witness",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "witness_merkle_root": "0xabc123...",
  "witness_timestamp": 1704110520,
  "witness_network": "nostr",
  "witness_smart_contract_address": "",
  "witness_transaction_hash": "nevent1qqsw...",
  "witness_sender_account_address": "npub1...",
  "witness_merkle_proof": []
}
```

### TSA Witness Example

```json
{
  "previous_verification_hash": "0xabc123...",
  "local_timestamp": "2024-01-01T12:02:00",
  "revision_type": "witness",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "witness_merkle_root": "0xabc123...",
  "witness_timestamp": 1704110520,
  "witness_network": "tsa",
  "witness_smart_contract_address": "https://timestamp.digicert.com",
  "witness_transaction_hash": "base64_tsa_response",
  "witness_sender_account_address": "",
  "witness_merkle_proof": []
}
```

### Validation Rules

1. For single witness: `witness_merkle_proof` must be empty array
2. For single witness: `witness_merkle_root` equals `previous_verification_hash`
3. For batched: Merkle proof must verify back to `witness_merkle_root`
4. Transaction must exist and be confirmed on specified network
5. `witness_timestamp` should match blockchain/service timestamp
6. For Ethereum: Contract address and sender address required

---

## Link Revision

Connects to other AquaTree chains.

### Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `previous_verification_hash` | string | Yes | Previous revision in this chain |
| `local_timestamp` | string | Yes | ISO 8601 timestamp |
| `revision_type` | string | Yes | Must be `"link"` |
| `version` | string | Yes | Protocol version string |
| `link_type` | string | No | Application-specific link type |
| `link_verification_hashes` | string[] | Yes | Array of hashes from other chains |
| `link_file_hashes` | string[] | No | Corresponding file hashes |

### Example

```json
{
  "previous_verification_hash": "0xabc123...",
  "local_timestamp": "2024-01-01T12:03:00",
  "revision_type": "link",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "link_type": "dependencies",
  "link_verification_hashes": [
    "0x111222333444555666777888999000aaabbbcccdddeeefff000111222333444",
    "0x222333444555666777888999000aaabbbcccdddeeefff000111222333444555",
    "0x333444555666777888999000aaabbbcccdddeeefff000111222333444555666"
  ],
  "link_file_hashes": [
    "0xfileHash1...",
    "0xfileHash2...",
    "0xfileHash3..."
  ]
}
```

### Validation Rules

1. `link_verification_hashes` must be non-empty array
2. Each hash in array must be valid revision hash
3. If `link_file_hashes` present, must have same length as `link_verification_hashes`
4. Referenced revisions should exist (optional strict validation)

---

## Hash Computation

### Scalar Method

1. Serialize revision as canonical JSON (sorted keys)
2. Compute SHA256 hash of serialized string
3. Prefix with `0x`

```typescript
const canonical = JSON.stringify(sortKeys(revision));
const hash = "0x" + sha256(canonical).toString('hex');
```

### Tree Method

1. Extract leaves array from revision
2. Build Merkle tree from leaves
3. Root hash becomes verification hash

```typescript
const leaves = revision.leaves;
const tree = new MerkleTree(leaves, sha256);
const hash = "0x" + tree.getRoot().toString('hex');
```

---

## AquaTree Storage Format

Complete AquaTree structure for storage/transmission:

```json
{
  "revisions": {
    "0xgenesis_hash": {
      "previous_verification_hash": "",
      "local_timestamp": "2024-01-01T12:00:00",
      "revision_type": "file",
      "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
      "file_hash": "0x...",
      "file_nonce": "0x..."
    },
    "0xsignature_hash": {
      "previous_verification_hash": "0xgenesis_hash",
      "local_timestamp": "2024-01-01T12:01:00",
      "revision_type": "signature",
      "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
      "signature_type": "cli",
      "signature": "0x...",
      "signature_wallet_address": "0x..."
    },
    "0xwitness_hash": {
      "previous_verification_hash": "0xsignature_hash",
      "local_timestamp": "2024-01-01T12:02:00",
      "revision_type": "witness",
      "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
      "witness_merkle_root": "0x...",
      "witness_timestamp": 1704110520,
      "witness_network": "sepolia",
      "witness_smart_contract_address": "0x...",
      "witness_transaction_hash": "0x...",
      "witness_sender_account_address": "0x...",
      "witness_merkle_proof": []
    }
  },
  "file_index": {
    "0xfile_hash": "document.pdf"
  },
  "tree": {
    "hash": "0xgenesis_hash",
    "children": [
      {
        "hash": "0xsignature_hash",
        "children": [
          {
            "hash": "0xwitness_hash",
            "children": []
          }
        ]
      }
    ]
  },
  "treeMapping": {
    "paths": {
      "0xgenesis_hash": ["0xgenesis_hash"],
      "0xsignature_hash": ["0xgenesis_hash", "0xsignature_hash"],
      "0xwitness_hash": ["0xgenesis_hash", "0xsignature_hash", "0xwitness_hash"]
    },
    "latestHash": "0xwitness_hash"
  }
}
```

---

## Field Constraints

### Hashes
- Format: Lowercase hexadecimal with `0x` prefix
- Length: 64 characters (32 bytes) + 2-char prefix = 66 total
- Example: `0x9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08`

### Timestamps
- Format: ISO 8601
- Pattern: `YYYY-MM-DDTHH:mm:ss`
- Example: `2024-01-01T12:00:00`

### Ethereum Addresses
- Format: EIP-55 checksummed
- Length: 42 characters (20 bytes + 0x)
- Mixed case for checksum
- Example: `0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb8`

### Nonces
- Length: Exactly 16 bytes (32 hex chars + 0x)
- Format: Lowercase hexadecimal with `0x` prefix
- Example: `0x3fa8b1c2d3e4f5a67b8c9d0e1f2a3b4c`

---

## Version Compatibility

- **v3.2.x**: Current version, fully compatible
- **v3.1.x**: Compatible, minor improvements
- **v3.0.x**: Compatible, initial TypeScript release
- **v2.x**: Not compatible, different schema

---

## See Also

- [Introduction](/previous_versions/version_3/introduction) - Getting started
- [Concepts](/previous_versions/version_3/concepts) - Core concepts
- [Tooling](/previous_versions/version_3/tooling) - SDK API reference
15:T45aa,
# Aqua Protocol v3 - Schema Reference

This document provides comprehensive technical specifications for all revision types in Aqua Protocol v3. Each revision type has specific fields and validation rules.

## Version String Format

```
https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: {scalar|tree}
```

**Components:**
- Protocol URL: `https://aqua-protocol.org/docs/v3/schema_2`
- Hash Algorithm: `SHA256`
- Canonicalization Method: `scalar` or `tree`

## Common Fields

All revisions share these mandatory fields:

| Field | Type | Description | Validation |
|-------|------|-------------|------------|
| `previous_verification_hash` | string | Hash of previous revision | Empty string for genesis, otherwise 64-char hex with `0x` prefix |
| `local_timestamp` | string | ISO 8601 timestamp | Valid ISO 8601 format: `YYYY-MM-DDTHH:mm:ss` |
| `revision_type` | string | Type of revision | One of: `"file"`, `"form"`, `"signature"`, `"witness"`, `"link"` |
| `version` | string | Protocol version and method | Must match format above |

---

## File Revision

Represents a file with metadata and optional content.

### Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `previous_verification_hash` | string | Yes | Previous revision hash (empty for genesis) |
| `local_timestamp` | string | Yes | ISO 8601 timestamp |
| `revision_type` | string | Yes | Must be `"file"` |
| `version` | string | Yes | Protocol version string |
| `file_hash` | string | Yes | SHA256 hash of file content (hex with `0x`) |
| `file_nonce` | string | Yes | Random 16-byte nonce (hex with `0x`) |
| `content` | string/Uint8Array | No | Optional file content |
| `leaves` | string[] | Conditional | Required if `Method: tree`, array of leaf hashes |

### Genesis File Revision (Scalar)

```json
{
  "previous_verification_hash": "",
  "local_timestamp": "2024-01-01T12:00:00",
  "revision_type": "file",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "file_hash": "0x9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08",
  "file_nonce": "0x3fa8b1c2d3e4f5a67b8c9d0e1f2a3b4c"
}
```

### Genesis File Revision (Tree)

```json
{
  "previous_verification_hash": "",
  "local_timestamp": "2024-01-01T12:00:00",
  "revision_type": "file",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: tree",
  "file_hash": "0x9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08",
  "file_nonce": "0x3fa8b1c2d3e4f5a67b8c9d0e1f2a3b4c",
  "leaves": [
    "0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef",
    "0xabcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890"
  ]
}
```

### With Content

```json
{
  "previous_verification_hash": "",
  "local_timestamp": "2024-01-01T12:00:00",
  "revision_type": "file",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "file_hash": "0x9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08",
  "file_nonce": "0x3fa8b1c2d3e4f5a67b8c9d0e1f2a3b4c",
  "content": "This is the file content as a string"
}
```

### Validation Rules

1. `file_hash` must match SHA256 of file content
2. `file_nonce` must be exactly 16 bytes (32 hex chars + `0x`)
3. If `Method: tree`, `leaves` array must be present
4. If `Method: scalar`, `leaves` must be absent
5. `content` is optional but if present, hash must match `file_hash`

---

## Form Revision

Stores structured key-value data.

### Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `previous_verification_hash` | string | Yes | Previous revision hash (empty for genesis) |
| `local_timestamp` | string | Yes | ISO 8601 timestamp |
| `revision_type` | string | Yes | Must be `"form"` |
| `version` | string | Yes | Protocol version string |
| `file_hash` | string | Yes | SHA256 hash of form data |
| `file_nonce` | string | Yes | Random 16-byte nonce |
| `content` | object | Yes | Form data as key-value pairs |
| `leaves` | string[] | Conditional | Required if `Method: tree` |

### Example (Scalar)

```json
{
  "previous_verification_hash": "",
  "local_timestamp": "2024-01-01T12:00:00",
  "revision_type": "form",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "file_hash": "0xabc123def456...",
  "file_nonce": "0x7c8d9e0f1a2b3c4d5e6f7a8b9c0d1e2f",
  "content": {
    "name": "John Doe",
    "email": "john@example.com",
    "organization": "Example Corp",
    "role": "Developer"
  }
}
```

### Example (Tree)

```json
{
  "previous_verification_hash": "",
  "local_timestamp": "2024-01-01T12:00:00",
  "revision_type": "form",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: tree",
  "file_hash": "0xabc123def456...",
  "file_nonce": "0x7c8d9e0f1a2b3c4d5e6f7a8b9c0d1e2f",
  "content": {
    "name": "John Doe",
    "email": "john@example.com",
    "organization": "Example Corp",
    "role": "Developer"
  },
  "leaves": [
    "0x...",  // SHA256("name:John Doe")
    "0x...",  // SHA256("email:john@example.com")
    "0x...",  // SHA256("organization:Example Corp")
    "0x..."   // SHA256("role:Developer")
  ]
}
```

### Leaf Computation (Tree Mode)

For each key-value pair in `content`:
```typescript
leaf_hash = SHA256(`${key}:${value}`)
```

### Validation Rules

1. `content` must be a valid JSON object
2. All values in `content` must be strings
3. `file_hash` must match hash of canonicalized content
4. If `Method: tree`, number of leaves must match number of keys in content

---

## Signature Revision

Adds cryptographic signature to verify authenticity.

### Common Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `previous_verification_hash` | string | Yes | Hash of revision being signed |
| `local_timestamp` | string | Yes | ISO 8601 timestamp |
| `revision_type` | string | Yes | Must be `"signature"` |
| `version` | string | Yes | Protocol version string |
| `signature_type` | string | Yes | Type: `"cli"`, `"metamask"`, `"did"`, `"p12"`, `"inline"` |

### CLI / MetaMask Signature

**Additional Fields:**
| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `signature` | string | Yes | Hex-encoded signature (65 bytes for ECDSA) |
| `signature_wallet_address` | string | Yes | Ethereum address (EIP-55 checksummed) |

**Example:**
```json
{
  "previous_verification_hash": "0xabc123...",
  "local_timestamp": "2024-01-01T12:01:00",
  "revision_type": "signature",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "signature_type": "cli",
  "signature": "0x8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2c3d4e5f6a7b8c9d1c",
  "signature_wallet_address": "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb8"
}
```

### DID Signature

**Additional Fields:**
| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `signature` | object | Yes | JWS (JSON Web Signature) object |

**Signature Object Structure:**
```typescript
{
  payload: string;       // Base64url-encoded payload
  signatures: [{
    protected: string;   // Base64url-encoded protected header
    signature: string;   // Base64url-encoded signature
  }]
}
```

**Example:**
```json
{
  "previous_verification_hash": "0xabc123...",
  "local_timestamp": "2024-01-01T12:01:00",
  "revision_type": "signature",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "signature_type": "did",
  "signature": {
    "payload": "eyJhbGciOiJFZERTQSIsImI2NCI6ZmFsc2UsImNyaXQiOlsiYjY0Il19",
    "signatures": [{
      "protected": "eyJhbGciOiJFZERTQSJ9",
      "signature": "kKvXJ_qjJRtGQFLpRvQlCdXMFD8sSE4DTlbMmLqg0BJ9FQKLHvX7y_z5Pr8u0xT8D2vCj9qL1KzN4rP2MzKfBQ"
    }]
  }
}
```

### P12 Certificate Signature

**Additional Fields:**
| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `signature` | string | Yes | Hex-encoded signature |
| `signature_public_key` | string | Yes | Hex-encoded DER public key |

**Example:**
```json
{
  "previous_verification_hash": "0xabc123...",
  "local_timestamp": "2024-01-01T12:01:00",
  "revision_type": "signature",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "signature_type": "p12",
  "signature": "0x...",
  "signature_public_key": "0x308201a2300d06092a864886f70d01010105000382018f..."
}
```

### Inline Signature

Same as CLI/MetaMask but with pre-computed signature.

### Validation Rules

1. Signature must be verifiable using provided credentials
2. For CLI/MetaMask: Address must be recoverable from signature
3. For DID: JWS must be valid and verifiable
4. For P12: Signature must verify with public key
5. Signature must be computed over `previous_verification_hash`

---

## Witness Revision

Anchors revision to blockchain or timestamping service.

### Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `previous_verification_hash` | string | Yes | Hash being witnessed |
| `local_timestamp` | string | Yes | ISO 8601 timestamp |
| `revision_type` | string | Yes | Must be `"witness"` |
| `version` | string | Yes | Protocol version string |
| `witness_merkle_root` | string | Yes | Root hash of Merkle tree |
| `witness_timestamp` | number | Yes | Unix timestamp from witness service |
| `witness_network` | string | Yes | Network: `"mainnet"`, `"sepolia"`, `"holesky"`, `"tsa"`, `"nostr"` |
| `witness_smart_contract_address` | string | Conditional | Required for Ethereum |
| `witness_transaction_hash` | string | Yes | Transaction or event hash |
| `witness_sender_account_address` | string | Conditional | Required for Ethereum |
| `witness_merkle_proof` | string[] | Yes | Merkle proof (empty for single witness) |

### Ethereum Witness Example

```json
{
  "previous_verification_hash": "0xabc123...",
  "local_timestamp": "2024-01-01T12:02:00",
  "revision_type": "witness",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "witness_merkle_root": "0xdef456...",
  "witness_timestamp": 1704110520,
  "witness_network": "sepolia",
  "witness_smart_contract_address": "0x5FbDB2315678afecb367f032d93F642f64180aa3",
  "witness_transaction_hash": "0x9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08",
  "witness_sender_account_address": "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb8",
  "witness_merkle_proof": []
}
```

### Batched Witness Example

Multiple revisions witnessed in single transaction:

```json
{
  "previous_verification_hash": "0xabc123...",
  "local_timestamp": "2024-01-01T12:02:00",
  "revision_type": "witness",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "witness_merkle_root": "0xroot...",
  "witness_timestamp": 1704110520,
  "witness_network": "mainnet",
  "witness_smart_contract_address": "0x5FbDB2315678afecb367f032d93F642f64180aa3",
  "witness_transaction_hash": "0x9f86d081...",
  "witness_sender_account_address": "0x742d35Cc...",
  "witness_merkle_proof": [
    "0xsibling_hash_1",
    "0xsibling_hash_2",
    "0xsibling_hash_3"
  ]
}
```

### Nostr Witness Example

```json
{
  "previous_verification_hash": "0xabc123...",
  "local_timestamp": "2024-01-01T12:02:00",
  "revision_type": "witness",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "witness_merkle_root": "0xabc123...",
  "witness_timestamp": 1704110520,
  "witness_network": "nostr",
  "witness_smart_contract_address": "",
  "witness_transaction_hash": "nevent1qqsw...",
  "witness_sender_account_address": "npub1...",
  "witness_merkle_proof": []
}
```

### TSA Witness Example

```json
{
  "previous_verification_hash": "0xabc123...",
  "local_timestamp": "2024-01-01T12:02:00",
  "revision_type": "witness",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "witness_merkle_root": "0xabc123...",
  "witness_timestamp": 1704110520,
  "witness_network": "tsa",
  "witness_smart_contract_address": "https://timestamp.digicert.com",
  "witness_transaction_hash": "base64_tsa_response",
  "witness_sender_account_address": "",
  "witness_merkle_proof": []
}
```

### Validation Rules

1. For single witness: `witness_merkle_proof` must be empty array
2. For single witness: `witness_merkle_root` equals `previous_verification_hash`
3. For batched: Merkle proof must verify back to `witness_merkle_root`
4. Transaction must exist and be confirmed on specified network
5. `witness_timestamp` should match blockchain/service timestamp
6. For Ethereum: Contract address and sender address required

---

## Link Revision

Connects to other AquaTree chains.

### Fields

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `previous_verification_hash` | string | Yes | Previous revision in this chain |
| `local_timestamp` | string | Yes | ISO 8601 timestamp |
| `revision_type` | string | Yes | Must be `"link"` |
| `version` | string | Yes | Protocol version string |
| `link_type` | string | No | Application-specific link type |
| `link_verification_hashes` | string[] | Yes | Array of hashes from other chains |
| `link_file_hashes` | string[] | No | Corresponding file hashes |

### Example

```json
{
  "previous_verification_hash": "0xabc123...",
  "local_timestamp": "2024-01-01T12:03:00",
  "revision_type": "link",
  "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
  "link_type": "dependencies",
  "link_verification_hashes": [
    "0x111222333444555666777888999000aaabbbcccdddeeefff000111222333444",
    "0x222333444555666777888999000aaabbbcccdddeeefff000111222333444555",
    "0x333444555666777888999000aaabbbcccdddeeefff000111222333444555666"
  ],
  "link_file_hashes": [
    "0xfileHash1...",
    "0xfileHash2...",
    "0xfileHash3..."
  ]
}
```

### Validation Rules

1. `link_verification_hashes` must be non-empty array
2. Each hash in array must be valid revision hash
3. If `link_file_hashes` present, must have same length as `link_verification_hashes`
4. Referenced revisions should exist (optional strict validation)

---

## Hash Computation

### Scalar Method

1. Serialize revision as canonical JSON (sorted keys)
2. Compute SHA256 hash of serialized string
3. Prefix with `0x`

```typescript
const canonical = JSON.stringify(sortKeys(revision));
const hash = "0x" + sha256(canonical).toString('hex');
```

### Tree Method

1. Extract leaves array from revision
2. Build Merkle tree from leaves
3. Root hash becomes verification hash

```typescript
const leaves = revision.leaves;
const tree = new MerkleTree(leaves, sha256);
const hash = "0x" + tree.getRoot().toString('hex');
```

---

## AquaTree Storage Format

Complete AquaTree structure for storage/transmission:

```json
{
  "revisions": {
    "0xgenesis_hash": {
      "previous_verification_hash": "",
      "local_timestamp": "2024-01-01T12:00:00",
      "revision_type": "file",
      "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
      "file_hash": "0x...",
      "file_nonce": "0x..."
    },
    "0xsignature_hash": {
      "previous_verification_hash": "0xgenesis_hash",
      "local_timestamp": "2024-01-01T12:01:00",
      "revision_type": "signature",
      "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
      "signature_type": "cli",
      "signature": "0x...",
      "signature_wallet_address": "0x..."
    },
    "0xwitness_hash": {
      "previous_verification_hash": "0xsignature_hash",
      "local_timestamp": "2024-01-01T12:02:00",
      "revision_type": "witness",
      "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
      "witness_merkle_root": "0x...",
      "witness_timestamp": 1704110520,
      "witness_network": "sepolia",
      "witness_smart_contract_address": "0x...",
      "witness_transaction_hash": "0x...",
      "witness_sender_account_address": "0x...",
      "witness_merkle_proof": []
    }
  },
  "file_index": {
    "0xfile_hash": "document.pdf"
  },
  "tree": {
    "hash": "0xgenesis_hash",
    "children": [
      {
        "hash": "0xsignature_hash",
        "children": [
          {
            "hash": "0xwitness_hash",
            "children": []
          }
        ]
      }
    ]
  },
  "treeMapping": {
    "paths": {
      "0xgenesis_hash": ["0xgenesis_hash"],
      "0xsignature_hash": ["0xgenesis_hash", "0xsignature_hash"],
      "0xwitness_hash": ["0xgenesis_hash", "0xsignature_hash", "0xwitness_hash"]
    },
    "latestHash": "0xwitness_hash"
  }
}
```

---

## Field Constraints

### Hashes
- Format: Lowercase hexadecimal with `0x` prefix
- Length: 64 characters (32 bytes) + 2-char prefix = 66 total
- Example: `0x9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08`

### Timestamps
- Format: ISO 8601
- Pattern: `YYYY-MM-DDTHH:mm:ss`
- Example: `2024-01-01T12:00:00`

### Ethereum Addresses
- Format: EIP-55 checksummed
- Length: 42 characters (20 bytes + 0x)
- Mixed case for checksum
- Example: `0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb8`

### Nonces
- Length: Exactly 16 bytes (32 hex chars + 0x)
- Format: Lowercase hexadecimal with `0x` prefix
- Example: `0x3fa8b1c2d3e4f5a67b8c9d0e1f2a3b4c`

---

## Version Compatibility

- **v3.2.x**: Current version, fully compatible
- **v3.1.x**: Compatible, minor improvements
- **v3.0.x**: Compatible, initial TypeScript release
- **v2.x**: Not compatible, different schema

---

## See Also

- [Introduction](/previous_versions/version_3/introduction) - Getting started
- [Concepts](/previous_versions/version_3/concepts) - Core concepts
- [Tooling](/previous_versions/version_3/tooling) - SDK API reference
16:T3ef3,
# Aqua Protocol v3 - Tooling & SDK

The Aqua JS SDK (aqua-js-sdk) is a comprehensive TypeScript library for working with Aqua Protocol v3. It provides a complete API for creating, signing, witnessing, and verifying revision chains across multiple platforms.

## Installation

```bash
npm install aqua-js-sdk
```

### Platform-Specific Imports

```typescript
// Node.js (default)
import Aquafier from 'aqua-js-sdk';

// Web Browser
import Aquafier from 'aqua-js-sdk/web';

// React Native
import Aquafier from 'aqua-js-sdk/react-native';
```

## Core API

### Aquafier Class

The main class providing all Aqua Protocol operations.

#### Constructor

```typescript
const aquafier = new Aquafier();
```

No configuration needed for initialization.

---

### Creating Revisions

#### createGenesisRevision()

Creates the first revision in a new AquaTree.

**Signature:**
```typescript
async createGenesisRevision(
  fileObject: FileObject,
  isForm?: boolean,
  enableContent?: boolean,
  enableScalar?: boolean
): Promise<Result<AquaOperationData, LogData[]>>
```

**Parameters:**
- `fileObject`: File data to create revision from
- `isForm`: If true, creates form revision (default: false)
- `enableContent`: Include file content in revision (default: false)
- `enableScalar`: Use scalar method instead of tree (default: true)

**Returns:**
- Success: `AquaOperationData` with new AquaTree
- Failure: Array of error logs

**Example:**
```typescript
const fileObject: FileObject = {
  fileName: "contract.pdf",
  fileContent: pdfBuffer, // Uint8Array or string
  path: "/documents/contract.pdf"
};

const result = await aquafier.createGenesisRevision(fileObject);

if (result.isErr) {
  result.data.logData.forEach(log => console.error(log));
  return;
}

const aquaTree = result.data.aquaTree;
```

#### createNewRevision()

Adds a new file/form revision to an existing AquaTree.

**Signature:**
```typescript
async createNewRevision(
  aquaTree: AquaTree,
  fileObject: FileObject,
  isForm?: boolean,
  enableContent?: boolean,
  enableScalar?: boolean
): Promise<Result<AquaOperationData, LogData[]>>
```

**Example:**
```typescript
const result = await aquafier.createNewRevision(
  existingAquaTree,
  updatedFileObject,
  false,  // not a form
  false,  // don't embed content
  true    // use scalar method
);
```

---

### Signing Revisions

#### signRevision()

Signs the latest revision in an AquaTree.

**Signature:**
```typescript
async signRevision(
  aquaTree: AquaTree,
  signType: SignType,
  credentials?: CredentialsData,
  inlineOptions?: InlineSignerOptions
): Promise<Result<AquaOperationData, LogData[]>>
```

**Parameters:**
- `signType`: One of `"cli"`, `"metamask"`, `"did"`, `"p12"`, `"inline"`
- `credentials`: Credentials for CLI, DID, or P12 signing
- `inlineOptions`: Pre-computed signature for inline mode

**Sign Types:**

##### CLI Signing
Uses BIP39 mnemonic to derive wallet and sign.

```typescript
const credentials: CredentialsData = {
  mnemonic: "abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon about",
  // ... other fields
};

const result = await aquafier.signRevision(
  aquaTree,
  "cli",
  credentials
);
```

##### MetaMask Signing
Opens MetaMask for user to sign (browser only).

```typescript
const result = await aquafier.signRevision(
  aquaTree,
  "metamask"
);
```

**React Native MetaMask:**
```typescript
const result = await aquafier.signRevision(
  aquaTree,
  "metamask",
  undefined,
  {
    deepLinkUrl: "metamask://",
    callbackUrl: "myapp://metamask-callback",
    onDeepLinkReady: (url) => {
      // Open MetaMask app
      Linking.openURL(url);
    }
  }
);
```

##### DID Signing
Signs with Decentralized Identifier.

```typescript
const credentials: CredentialsData = {
  did_key: "your-did-key-here",
  // ... other fields
};

const result = await aquafier.signRevision(
  aquaTree,
  "did",
  credentials
);
```

##### P12 Certificate Signing
Signs with P12 certificate.

```typescript
const credentials: CredentialsData = {
  p12_password: "certificate-password",
  p12_content: "base64-encoded-p12-content",
  // ... other fields
};

const result = await aquafier.signRevision(
  aquaTree,
  "p12",
  credentials
);
```

##### Inline Signing
Use pre-computed signature.

```typescript
const inlineOptions: InlineSignerOptions = {
  walletAddress: "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb8",
  signature: "0x8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f..."
};

const result = await aquafier.signRevision(
  aquaTree,
  "inline",
  undefined,
  inlineOptions
);
```

---

### Witnessing Revisions

#### witnessRevision()

Timestamps a revision via blockchain or TSA.

**Signature:**
```typescript
async witnessRevision(
  aquaTree: AquaTree,
  witnessType: WitnessType,
  witnessConfig: WitnessConfig,
  credentials?: CredentialsData,
  witnessPlatform?: WitnessPlatformType,
  inlineOptions?: InlineWitnessOptions
): Promise<Result<AquaOperationData, LogData[]>>
```

**Parameters:**
- `witnessType`: `"eth"`, `"nostr"`, or `"tsa"`
- `witnessConfig`: Network and contract configuration
- `credentials`: Credentials for signing transaction
- `witnessPlatform`: `"cli"` or `"metamask"` (Ethereum only)
- `inlineOptions`: Pre-computed transaction (inline mode)

#### Ethereum Witnessing

**Configuration:**
```typescript
const witnessConfig: WitnessConfig = {
  witnessEventVerificationHash: latestRevisionHash,
  witnessNetwork: "sepolia",  // or "mainnet", "holesky"
  smartContractAddress: "0x5FbDB2315678afecb367f032d93F642f64180aa3"
};

const credentials: CredentialsData = {
  mnemonic: "your mnemonic here",
  // ...
};
```

**CLI Method** (uses mnemonic):
```typescript
const result = await aquafier.witnessRevision(
  aquaTree,
  "eth",
  witnessConfig,
  credentials,
  "cli"
);
```

**MetaMask Method** (prompts user):
```typescript
const result = await aquafier.witnessRevision(
  aquaTree,
  "eth",
  witnessConfig,
  undefined,
  "metamask"
);
```

#### Nostr Witnessing

```typescript
const witnessConfig: WitnessConfig = {
  witnessEventVerificationHash: latestRevisionHash,
  witnessNetwork: "sepolia",  // not used for Nostr
  smartContractAddress: ""     // not used for Nostr
};

const credentials: CredentialsData = {
  nostr_sk: "your-nostr-secret-key",
  // ...
};

const result = await aquafier.witnessRevision(
  aquaTree,
  "nostr",
  witnessConfig,
  credentials
);
```

#### TSA Witnessing

```typescript
const result = await aquafier.witnessRevision(
  aquaTree,
  "tsa",
  witnessConfig
);
```

---

### Linking Revisions

#### linkRevision()

Creates a link revision connecting to other AquaTrees.

**Signature:**
```typescript
async linkRevision(
  aquaTree: AquaTree,
  linkedAquaTrees: AquaTree[],
  linkType?: string
): Promise<Result<AquaOperationData, LogData[]>>
```

**Example:**
```typescript
const result = await aquafier.linkRevision(
  mainAquaTree,
  [dependency1Tree, dependency2Tree, dependency3Tree],
  "dependencies"
);
```

---

### Verification

#### verifyRevisionChain()

Verifies an entire AquaTree chain.

**Signature:**
```typescript
async verifyRevisionChain(
  aquaTree: AquaTree,
  credentials?: CredentialsData
): Promise<VerificationGraphData>
```

**Parameters:**
- `aquaTree`: Tree to verify
- `credentials`: Optional, for Ethereum witness lookup

**Returns:**
- `VerificationGraphData`: Graph structure with verification results

**Example:**
```typescript
const verificationResult = await aquafier.verifyRevisionChain(aquaTree, credentials);

// Check overall success
if (verificationResult.isValidationSuccessful) {
  console.log("âœ“ Chain is valid");
} else {
  console.log("âœ— Chain validation failed");
}

// Traverse verification graph
function printResults(node: VerificationGraphData, depth = 0) {
  const indent = "  ".repeat(depth);
  const status = node.isValidationSuccessful ? "âœ“" : "âœ—";
  console.log(`${indent}${status} ${node.revisionType}`);

  node.verificationGraphData.forEach(child => printResults(child, depth + 1));
}

printResults(verificationResult);
```

#### verifyFormRevision()

Verifies form-specific data.

**Signature:**
```typescript
async verifyFormRevision(
  aquaTree: AquaTree,
  formData: FormData
): Promise<FormVerificationResponseData>
```

---

### Utility Methods

#### removeLastRevision()

Removes the most recent revision from an AquaTree.

**Signature:**
```typescript
removeLastRevision(
  aquaTree: AquaTree
): Result<AquaOperationData, LogData[]>
```

**Example:**
```typescript
const result = aquafier.removeLastRevision(aquaTree);

if (result.isOk) {
  const updatedTree = result.data.aquaTree;
  console.log("Revision removed successfully");
}
```

#### checkIfFileAlreadyNotarized()

Checks if a file has already been notarized.

**Signature:**
```typescript
checkIfFileAlreadyNotarized(
  aquaTree: AquaTree,
  fileObject: FileObject
): boolean
```

#### fetchFilesToBeRead()

Gets list of files that need content loaded.

**Signature:**
```typescript
fetchFilesToBeRead(aquaTree: AquaTree): string[]
```

---

## Type Reference

### Core Types

```typescript
interface FileObject {
  fileName: string
  fileContent: string | AquaTree | Uint8Array | Record<string, string> | object
  path: string
  fileSize?: number
}

interface AquaTree {
  revisions: Revisions
  file_index: FileIndex
  tree?: RevisionTree
  treeMapping?: TreeMapping
}

interface Revision {
  previous_verification_hash: string
  local_timestamp: string
  revision_type: RevisionType
  version: string
  // ... type-specific fields
}

type RevisionType = "file" | "witness" | "signature" | "form" | "link"
type SignType = "metamask" | "cli" | "did" | "p12" | "inline"
type WitnessType = "tsa" | "eth" | "nostr"
type WitnessNetwork = "sepolia" | "mainnet" | "holesky"
```

### Result Type

```typescript
type Result<T, E> =
  | { isOk: true; isErr: false; data: T }
  | { isOk: false; isErr: true; data: E }
```

### Configuration Types

```typescript
interface CredentialsData {
  mnemonic: string
  nostr_sk: string
  did_key: string
  alchemy_key: string
  witness_eth_network: string
  witness_method: string
  p12_password?: string
  p12_content?: string
}

interface WitnessConfig {
  witnessEventVerificationHash: string
  witnessNetwork: WitnessNetwork
  smartContractAddress: string
}
```

---

## Platform-Specific Notes

### Node.js

Full functionality available:
- All signing methods
- All witnessing methods
- File system access
- HTTP server for MetaMask callback

```typescript
import Aquafier from 'aqua-js-sdk';
import fs from 'fs';

const aquafier = new Aquafier();

// Read file from disk
const fileContent = fs.readFileSync('document.pdf');

const fileObject = {
  fileName: 'document.pdf',
  fileContent: fileContent,
  path: './document.pdf'
};
```

### Web Browser

Most functionality available:
- MetaMask signing (primary method)
- DID signing
- Ethereum witnessing via MetaMask
- Nostr, TSA witnessing

**Limitations:**
- No P12 signing (requires file system)
- No CLI signing with mnemonic (security risk in browser)

```typescript
import Aquafier from 'aqua-js-sdk/web';

const aquafier = new Aquafier();

// File from input element
const file = document.getElementById('fileInput').files[0];
const arrayBuffer = await file.arrayBuffer();

const fileObject = {
  fileName: file.name,
  fileContent: new Uint8Array(arrayBuffer),
  path: file.name
};
```

### React Native

Most functionality with platform adaptations:
- MetaMask via deep linking
- DID signing
- Limited witnessing

**Limitations:**
- No local HTTP server
- MetaMask requires custom deep linking
- File system needs react-native-fs

```typescript
import Aquafier from 'aqua-js-sdk/react-native';
import RNFS from 'react-native-fs';

const aquafier = new Aquafier();

// Read file
const fileContent = await RNFS.readFile(filePath, 'base64');

const fileObject = {
  fileName: 'document.pdf',
  fileContent: Buffer.from(fileContent, 'base64'),
  path: filePath
};
```

---

## Complete Workflow Examples

### Document Notarization

```typescript
// 1. Create genesis
const fileObject: FileObject = {
  fileName: "contract.pdf",
  fileContent: pdfBuffer,
  path: "/contracts/contract.pdf"
};

let result = await aquafier.createGenesisRevision(fileObject);
let aquaTree = result.data.aquaTree;

// 2. Sign with CLI
const credentials: CredentialsData = {
  mnemonic: process.env.MNEMONIC,
  // ... other fields
};

result = await aquafier.signRevision(aquaTree, "cli", credentials);
aquaTree = result.data.aquaTree;

// 3. Witness to Ethereum
const witnessConfig: WitnessConfig = {
  witnessEventVerificationHash: Object.keys(aquaTree.revisions)[Object.keys(aquaTree.revisions).length - 1],
  witnessNetwork: "sepolia",
  smartContractAddress: "0x5FbDB2315678afecb367f032d93F642f64180aa3"
};

result = await aquafier.witnessRevision(
  aquaTree,
  "eth",
  witnessConfig,
  credentials,
  "cli"
);
aquaTree = result.data.aquaTree;

// 4. Save
fs.writeFileSync('contract.aqua.json', JSON.stringify(aquaTree, null, 2));
```

### Multi-Party Approval

```typescript
// Party 1: Create and sign
let result = await aquafier.createGenesisRevision(fileObject);
let aquaTree = result.data.aquaTree;

result = await aquafier.signRevision(aquaTree, "cli", party1Credentials);
aquaTree = result.data.aquaTree;

// Send aquaTree to Party 2

// Party 2: Add signature
result = await aquafier.signRevision(aquaTree, "metamask");
aquaTree = result.data.aquaTree;

// Send back to Party 1

// Party 1: Witness
result = await aquafier.witnessRevision(
  aquaTree,
  "eth",
  witnessConfig,
  party1Credentials,
  "cli"
);
aquaTree = result.data.aquaTree;
```

### Form Submission with Verification

```typescript
// 1. Create form genesis
const formData = {
  name: "John Doe",
  email: "john@example.com",
  status: "pending"
};

const fileObject: FileObject = {
  fileName: "application.json",
  fileContent: formData,
  path: "/forms/application.json"
};

let result = await aquafier.createGenesisRevision(fileObject, true);  // isForm=true
let aquaTree = result.data.aquaTree;

// 2. Sign
result = await aquafier.signRevision(aquaTree, "did", credentials);
aquaTree = result.data.aquaTree;

// 3. Witness
result = await aquafier.witnessRevision(aquaTree, "nostr", witnessConfig, credentials);
aquaTree = result.data.aquaTree;

// 4. Verify form
const verifyResult = await aquafier.verifyFormRevision(aquaTree, formData);
console.log("Form valid:", verifyResult.isOk);
```

---

## Error Handling

All methods return `Result<T, E>` type. Always check for errors:

```typescript
const result = await aquafier.createGenesisRevision(fileObject);

if (result.isErr) {
  // Handle error
  console.error("Failed to create genesis:");
  result.data.forEach(log => {
    console.error(`[${log.logType}] ${log.log}`);
  });
  return;
}

// Success
const aquaTree = result.data.aquaTree;
```

---

## Best Practices

1. **Always verify results**: Check `isErr` before using data
2. **Store credentials securely**: Never commit mnemonic/keys
3. **Use environment variables**: Store sensitive data in `.env`
4. **Validate inputs**: Check file sizes and formats before processing
5. **Handle logs**: Display or log all LogData for debugging
6. **Test on testnets**: Use Sepolia/Holesky before mainnet
7. **Save AquaTrees**: Persist JSON after each operation
8. **Verify chains**: Run verification after receiving AquaTrees

---

## Testing

Create `credentials.json` for testing:

```json
{
  "mnemonic": "your test mnemonic",
  "nostr_sk": "your nostr secret key",
  "did_key": "your did key",
  "alchemy_key": "your alchemy api key",
  "witness_eth_network": "sepolia",
  "witness_method": "cli"
}
```

Run tests:
```bash
npm test
```

Run specific test file:
```bash
npm test -- ./tests/aquafier.test.ts
```

---

## See Also

- [Introduction](/previous_versions/version_3/introduction) - Getting started
- [Concepts](/previous_versions/version_3/concepts) - Core concepts
- [Schema Reference](/previous_versions/version_3/schema) - Revision specifications
- [GitHub Repository](https://github.com/inblockio/aqua-verifier-js-lib) - Source code and examples
17:T3ef3,
# Aqua Protocol v3 - Tooling & SDK

The Aqua JS SDK (aqua-js-sdk) is a comprehensive TypeScript library for working with Aqua Protocol v3. It provides a complete API for creating, signing, witnessing, and verifying revision chains across multiple platforms.

## Installation

```bash
npm install aqua-js-sdk
```

### Platform-Specific Imports

```typescript
// Node.js (default)
import Aquafier from 'aqua-js-sdk';

// Web Browser
import Aquafier from 'aqua-js-sdk/web';

// React Native
import Aquafier from 'aqua-js-sdk/react-native';
```

## Core API

### Aquafier Class

The main class providing all Aqua Protocol operations.

#### Constructor

```typescript
const aquafier = new Aquafier();
```

No configuration needed for initialization.

---

### Creating Revisions

#### createGenesisRevision()

Creates the first revision in a new AquaTree.

**Signature:**
```typescript
async createGenesisRevision(
  fileObject: FileObject,
  isForm?: boolean,
  enableContent?: boolean,
  enableScalar?: boolean
): Promise<Result<AquaOperationData, LogData[]>>
```

**Parameters:**
- `fileObject`: File data to create revision from
- `isForm`: If true, creates form revision (default: false)
- `enableContent`: Include file content in revision (default: false)
- `enableScalar`: Use scalar method instead of tree (default: true)

**Returns:**
- Success: `AquaOperationData` with new AquaTree
- Failure: Array of error logs

**Example:**
```typescript
const fileObject: FileObject = {
  fileName: "contract.pdf",
  fileContent: pdfBuffer, // Uint8Array or string
  path: "/documents/contract.pdf"
};

const result = await aquafier.createGenesisRevision(fileObject);

if (result.isErr) {
  result.data.logData.forEach(log => console.error(log));
  return;
}

const aquaTree = result.data.aquaTree;
```

#### createNewRevision()

Adds a new file/form revision to an existing AquaTree.

**Signature:**
```typescript
async createNewRevision(
  aquaTree: AquaTree,
  fileObject: FileObject,
  isForm?: boolean,
  enableContent?: boolean,
  enableScalar?: boolean
): Promise<Result<AquaOperationData, LogData[]>>
```

**Example:**
```typescript
const result = await aquafier.createNewRevision(
  existingAquaTree,
  updatedFileObject,
  false,  // not a form
  false,  // don't embed content
  true    // use scalar method
);
```

---

### Signing Revisions

#### signRevision()

Signs the latest revision in an AquaTree.

**Signature:**
```typescript
async signRevision(
  aquaTree: AquaTree,
  signType: SignType,
  credentials?: CredentialsData,
  inlineOptions?: InlineSignerOptions
): Promise<Result<AquaOperationData, LogData[]>>
```

**Parameters:**
- `signType`: One of `"cli"`, `"metamask"`, `"did"`, `"p12"`, `"inline"`
- `credentials`: Credentials for CLI, DID, or P12 signing
- `inlineOptions`: Pre-computed signature for inline mode

**Sign Types:**

##### CLI Signing
Uses BIP39 mnemonic to derive wallet and sign.

```typescript
const credentials: CredentialsData = {
  mnemonic: "abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon about",
  // ... other fields
};

const result = await aquafier.signRevision(
  aquaTree,
  "cli",
  credentials
);
```

##### MetaMask Signing
Opens MetaMask for user to sign (browser only).

```typescript
const result = await aquafier.signRevision(
  aquaTree,
  "metamask"
);
```

**React Native MetaMask:**
```typescript
const result = await aquafier.signRevision(
  aquaTree,
  "metamask",
  undefined,
  {
    deepLinkUrl: "metamask://",
    callbackUrl: "myapp://metamask-callback",
    onDeepLinkReady: (url) => {
      // Open MetaMask app
      Linking.openURL(url);
    }
  }
);
```

##### DID Signing
Signs with Decentralized Identifier.

```typescript
const credentials: CredentialsData = {
  did_key: "your-did-key-here",
  // ... other fields
};

const result = await aquafier.signRevision(
  aquaTree,
  "did",
  credentials
);
```

##### P12 Certificate Signing
Signs with P12 certificate.

```typescript
const credentials: CredentialsData = {
  p12_password: "certificate-password",
  p12_content: "base64-encoded-p12-content",
  // ... other fields
};

const result = await aquafier.signRevision(
  aquaTree,
  "p12",
  credentials
);
```

##### Inline Signing
Use pre-computed signature.

```typescript
const inlineOptions: InlineSignerOptions = {
  walletAddress: "0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb8",
  signature: "0x8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f..."
};

const result = await aquafier.signRevision(
  aquaTree,
  "inline",
  undefined,
  inlineOptions
);
```

---

### Witnessing Revisions

#### witnessRevision()

Timestamps a revision via blockchain or TSA.

**Signature:**
```typescript
async witnessRevision(
  aquaTree: AquaTree,
  witnessType: WitnessType,
  witnessConfig: WitnessConfig,
  credentials?: CredentialsData,
  witnessPlatform?: WitnessPlatformType,
  inlineOptions?: InlineWitnessOptions
): Promise<Result<AquaOperationData, LogData[]>>
```

**Parameters:**
- `witnessType`: `"eth"`, `"nostr"`, or `"tsa"`
- `witnessConfig`: Network and contract configuration
- `credentials`: Credentials for signing transaction
- `witnessPlatform`: `"cli"` or `"metamask"` (Ethereum only)
- `inlineOptions`: Pre-computed transaction (inline mode)

#### Ethereum Witnessing

**Configuration:**
```typescript
const witnessConfig: WitnessConfig = {
  witnessEventVerificationHash: latestRevisionHash,
  witnessNetwork: "sepolia",  // or "mainnet", "holesky"
  smartContractAddress: "0x5FbDB2315678afecb367f032d93F642f64180aa3"
};

const credentials: CredentialsData = {
  mnemonic: "your mnemonic here",
  // ...
};
```

**CLI Method** (uses mnemonic):
```typescript
const result = await aquafier.witnessRevision(
  aquaTree,
  "eth",
  witnessConfig,
  credentials,
  "cli"
);
```

**MetaMask Method** (prompts user):
```typescript
const result = await aquafier.witnessRevision(
  aquaTree,
  "eth",
  witnessConfig,
  undefined,
  "metamask"
);
```

#### Nostr Witnessing

```typescript
const witnessConfig: WitnessConfig = {
  witnessEventVerificationHash: latestRevisionHash,
  witnessNetwork: "sepolia",  // not used for Nostr
  smartContractAddress: ""     // not used for Nostr
};

const credentials: CredentialsData = {
  nostr_sk: "your-nostr-secret-key",
  // ...
};

const result = await aquafier.witnessRevision(
  aquaTree,
  "nostr",
  witnessConfig,
  credentials
);
```

#### TSA Witnessing

```typescript
const result = await aquafier.witnessRevision(
  aquaTree,
  "tsa",
  witnessConfig
);
```

---

### Linking Revisions

#### linkRevision()

Creates a link revision connecting to other AquaTrees.

**Signature:**
```typescript
async linkRevision(
  aquaTree: AquaTree,
  linkedAquaTrees: AquaTree[],
  linkType?: string
): Promise<Result<AquaOperationData, LogData[]>>
```

**Example:**
```typescript
const result = await aquafier.linkRevision(
  mainAquaTree,
  [dependency1Tree, dependency2Tree, dependency3Tree],
  "dependencies"
);
```

---

### Verification

#### verifyRevisionChain()

Verifies an entire AquaTree chain.

**Signature:**
```typescript
async verifyRevisionChain(
  aquaTree: AquaTree,
  credentials?: CredentialsData
): Promise<VerificationGraphData>
```

**Parameters:**
- `aquaTree`: Tree to verify
- `credentials`: Optional, for Ethereum witness lookup

**Returns:**
- `VerificationGraphData`: Graph structure with verification results

**Example:**
```typescript
const verificationResult = await aquafier.verifyRevisionChain(aquaTree, credentials);

// Check overall success
if (verificationResult.isValidationSuccessful) {
  console.log("âœ“ Chain is valid");
} else {
  console.log("âœ— Chain validation failed");
}

// Traverse verification graph
function printResults(node: VerificationGraphData, depth = 0) {
  const indent = "  ".repeat(depth);
  const status = node.isValidationSuccessful ? "âœ“" : "âœ—";
  console.log(`${indent}${status} ${node.revisionType}`);

  node.verificationGraphData.forEach(child => printResults(child, depth + 1));
}

printResults(verificationResult);
```

#### verifyFormRevision()

Verifies form-specific data.

**Signature:**
```typescript
async verifyFormRevision(
  aquaTree: AquaTree,
  formData: FormData
): Promise<FormVerificationResponseData>
```

---

### Utility Methods

#### removeLastRevision()

Removes the most recent revision from an AquaTree.

**Signature:**
```typescript
removeLastRevision(
  aquaTree: AquaTree
): Result<AquaOperationData, LogData[]>
```

**Example:**
```typescript
const result = aquafier.removeLastRevision(aquaTree);

if (result.isOk) {
  const updatedTree = result.data.aquaTree;
  console.log("Revision removed successfully");
}
```

#### checkIfFileAlreadyNotarized()

Checks if a file has already been notarized.

**Signature:**
```typescript
checkIfFileAlreadyNotarized(
  aquaTree: AquaTree,
  fileObject: FileObject
): boolean
```

#### fetchFilesToBeRead()

Gets list of files that need content loaded.

**Signature:**
```typescript
fetchFilesToBeRead(aquaTree: AquaTree): string[]
```

---

## Type Reference

### Core Types

```typescript
interface FileObject {
  fileName: string
  fileContent: string | AquaTree | Uint8Array | Record<string, string> | object
  path: string
  fileSize?: number
}

interface AquaTree {
  revisions: Revisions
  file_index: FileIndex
  tree?: RevisionTree
  treeMapping?: TreeMapping
}

interface Revision {
  previous_verification_hash: string
  local_timestamp: string
  revision_type: RevisionType
  version: string
  // ... type-specific fields
}

type RevisionType = "file" | "witness" | "signature" | "form" | "link"
type SignType = "metamask" | "cli" | "did" | "p12" | "inline"
type WitnessType = "tsa" | "eth" | "nostr"
type WitnessNetwork = "sepolia" | "mainnet" | "holesky"
```

### Result Type

```typescript
type Result<T, E> =
  | { isOk: true; isErr: false; data: T }
  | { isOk: false; isErr: true; data: E }
```

### Configuration Types

```typescript
interface CredentialsData {
  mnemonic: string
  nostr_sk: string
  did_key: string
  alchemy_key: string
  witness_eth_network: string
  witness_method: string
  p12_password?: string
  p12_content?: string
}

interface WitnessConfig {
  witnessEventVerificationHash: string
  witnessNetwork: WitnessNetwork
  smartContractAddress: string
}
```

---

## Platform-Specific Notes

### Node.js

Full functionality available:
- All signing methods
- All witnessing methods
- File system access
- HTTP server for MetaMask callback

```typescript
import Aquafier from 'aqua-js-sdk';
import fs from 'fs';

const aquafier = new Aquafier();

// Read file from disk
const fileContent = fs.readFileSync('document.pdf');

const fileObject = {
  fileName: 'document.pdf',
  fileContent: fileContent,
  path: './document.pdf'
};
```

### Web Browser

Most functionality available:
- MetaMask signing (primary method)
- DID signing
- Ethereum witnessing via MetaMask
- Nostr, TSA witnessing

**Limitations:**
- No P12 signing (requires file system)
- No CLI signing with mnemonic (security risk in browser)

```typescript
import Aquafier from 'aqua-js-sdk/web';

const aquafier = new Aquafier();

// File from input element
const file = document.getElementById('fileInput').files[0];
const arrayBuffer = await file.arrayBuffer();

const fileObject = {
  fileName: file.name,
  fileContent: new Uint8Array(arrayBuffer),
  path: file.name
};
```

### React Native

Most functionality with platform adaptations:
- MetaMask via deep linking
- DID signing
- Limited witnessing

**Limitations:**
- No local HTTP server
- MetaMask requires custom deep linking
- File system needs react-native-fs

```typescript
import Aquafier from 'aqua-js-sdk/react-native';
import RNFS from 'react-native-fs';

const aquafier = new Aquafier();

// Read file
const fileContent = await RNFS.readFile(filePath, 'base64');

const fileObject = {
  fileName: 'document.pdf',
  fileContent: Buffer.from(fileContent, 'base64'),
  path: filePath
};
```

---

## Complete Workflow Examples

### Document Notarization

```typescript
// 1. Create genesis
const fileObject: FileObject = {
  fileName: "contract.pdf",
  fileContent: pdfBuffer,
  path: "/contracts/contract.pdf"
};

let result = await aquafier.createGenesisRevision(fileObject);
let aquaTree = result.data.aquaTree;

// 2. Sign with CLI
const credentials: CredentialsData = {
  mnemonic: process.env.MNEMONIC,
  // ... other fields
};

result = await aquafier.signRevision(aquaTree, "cli", credentials);
aquaTree = result.data.aquaTree;

// 3. Witness to Ethereum
const witnessConfig: WitnessConfig = {
  witnessEventVerificationHash: Object.keys(aquaTree.revisions)[Object.keys(aquaTree.revisions).length - 1],
  witnessNetwork: "sepolia",
  smartContractAddress: "0x5FbDB2315678afecb367f032d93F642f64180aa3"
};

result = await aquafier.witnessRevision(
  aquaTree,
  "eth",
  witnessConfig,
  credentials,
  "cli"
);
aquaTree = result.data.aquaTree;

// 4. Save
fs.writeFileSync('contract.aqua.json', JSON.stringify(aquaTree, null, 2));
```

### Multi-Party Approval

```typescript
// Party 1: Create and sign
let result = await aquafier.createGenesisRevision(fileObject);
let aquaTree = result.data.aquaTree;

result = await aquafier.signRevision(aquaTree, "cli", party1Credentials);
aquaTree = result.data.aquaTree;

// Send aquaTree to Party 2

// Party 2: Add signature
result = await aquafier.signRevision(aquaTree, "metamask");
aquaTree = result.data.aquaTree;

// Send back to Party 1

// Party 1: Witness
result = await aquafier.witnessRevision(
  aquaTree,
  "eth",
  witnessConfig,
  party1Credentials,
  "cli"
);
aquaTree = result.data.aquaTree;
```

### Form Submission with Verification

```typescript
// 1. Create form genesis
const formData = {
  name: "John Doe",
  email: "john@example.com",
  status: "pending"
};

const fileObject: FileObject = {
  fileName: "application.json",
  fileContent: formData,
  path: "/forms/application.json"
};

let result = await aquafier.createGenesisRevision(fileObject, true);  // isForm=true
let aquaTree = result.data.aquaTree;

// 2. Sign
result = await aquafier.signRevision(aquaTree, "did", credentials);
aquaTree = result.data.aquaTree;

// 3. Witness
result = await aquafier.witnessRevision(aquaTree, "nostr", witnessConfig, credentials);
aquaTree = result.data.aquaTree;

// 4. Verify form
const verifyResult = await aquafier.verifyFormRevision(aquaTree, formData);
console.log("Form valid:", verifyResult.isOk);
```

---

## Error Handling

All methods return `Result<T, E>` type. Always check for errors:

```typescript
const result = await aquafier.createGenesisRevision(fileObject);

if (result.isErr) {
  // Handle error
  console.error("Failed to create genesis:");
  result.data.forEach(log => {
    console.error(`[${log.logType}] ${log.log}`);
  });
  return;
}

// Success
const aquaTree = result.data.aquaTree;
```

---

## Best Practices

1. **Always verify results**: Check `isErr` before using data
2. **Store credentials securely**: Never commit mnemonic/keys
3. **Use environment variables**: Store sensitive data in `.env`
4. **Validate inputs**: Check file sizes and formats before processing
5. **Handle logs**: Display or log all LogData for debugging
6. **Test on testnets**: Use Sepolia/Holesky before mainnet
7. **Save AquaTrees**: Persist JSON after each operation
8. **Verify chains**: Run verification after receiving AquaTrees

---

## Testing

Create `credentials.json` for testing:

```json
{
  "mnemonic": "your test mnemonic",
  "nostr_sk": "your nostr secret key",
  "did_key": "your did key",
  "alchemy_key": "your alchemy api key",
  "witness_eth_network": "sepolia",
  "witness_method": "cli"
}
```

Run tests:
```bash
npm test
```

Run specific test file:
```bash
npm test -- ./tests/aquafier.test.ts
```

---

## See Also

- [Introduction](/previous_versions/version_3/introduction) - Getting started
- [Concepts](/previous_versions/version_3/concepts) - Core concepts
- [Schema Reference](/previous_versions/version_3/schema) - Revision specifications
- [GitHub Repository](https://github.com/inblockio/aqua-verifier-js-lib) - Source code and examples
4:["$","$6",null,{"fallback":["$","div",null,{"className":"max-w-4xl mx-auto px-6 py-8","children":["$","div",null,{"className":"animate-pulse space-y-4","children":[["$","div",null,{"className":"h-8 bg-gray-200 rounded w-3/4"}],["$","div",null,{"className":"h-4 bg-gray-200 rounded w-1/2"}],["$","div",null,{"className":"space-y-3 mt-8","children":[["$","div",null,{"className":"h-4 bg-gray-200 rounded"}],["$","div",null,{"className":"h-4 bg-gray-200 rounded w-5/6"}],["$","div",null,{"className":"h-4 bg-gray-200 rounded w-4/6"}]]}]]}]}],"children":[["$","$Ld",null,{"header":["$","$Le",null,{"currentVersion":"v3.0.0","versions":["v1.0.0","v2.0.0","v3.0.0","v4.0.0"],"config":{"site":{"title":"Aqua Protocol Documentation","description":"Account & verify data in seconds using cryptographic proof","baseUrl":"/","language":"en","url":"https://docs.aquaprotocol.org","organizationName":"inblock.io","projectName":"aqua-protocol","activeVersion":"v4.0.0","logo":"/logo/aqua-logo.png","favicon":"/logo/aqua-logo.png"},"theme":{"defaultMode":"system","respectPrefersColorScheme":true,"primaryColor":"#E55B1F"},"navigation":{"showSidebar":true,"collapsibleSidebar":true,"showBreadcrumbs":true,"showTableOfContents":true,"tocPosition":"right","tocMaxDepth":3},"search":{"enabled":false,"provider":"meilisearch","placeholder":"Search documentation...","meilisearch":{"host":"http://localhost:7700","apiKey":"aSampleMasterKey","indexName":"aqua-docs"}},"features":{"showLastUpdated":true,"showReadingTime":true,"showAuthors":false,"showTags":true,"versioning":true,"i18n":false,"editUrl":"https://github.com/inblockio/aqua-docs/edit/main/docs"},"$schema":"./lib/config.types.ts","social":{"github":"https://github.com/inblockio","twitter":"https://x.com/inblockio","linkedin":"https://www.linkedin.com/company/inblock-io","custom":[{"label":"Aquafier","href":"https://dev.inblock.io/app"}]},"analytics":{"googleAnalytics":"","plausible":""},"footer":{"copyright":"Copyright Â© 2024 inblock.io. All rights reserved.","links":[{"title":"Documentation","items":[{"label":"Getting Started","href":"/docs/v4.0.0/getting-started/quickstart"},{"label":"Schema Reference","href":"/docs/v4.0.0/schema-reference/introduction"},{"label":"Use Cases","href":"/docs/v4.0.0/use-cases/introduction"}]},{"title":"Community","items":[{"label":"GitHub","href":"https://github.com/inblockio"},{"label":"Twitter","href":"https://x.com/inblockio"},{"label":"LinkedIn","href":"https://www.linkedin.com/company/inblock-io"}]},{"title":"Resources","items":[{"label":"Aquafier","href":"https://aquafier.inblock.io"},{"label":"Dev Environment","href":"https://dev.inblock.io"},{"label":"Contact","href":"mailto:info@inblock.io"}]}]},"banner":{"enabled":true,"message":"ðŸŽ‰ Aqua Protocol v4 is now in Beta! Check out the latest features.","type":"info","dismissible":true},"env":{"API_BASE_URL":"https://api.aquaprotocol.org","API_VERSION":"v4","AQUAFIER_URL":"https://aquafier.inblock.io","AQUAFIER_DEV_URL":"https://dev.inblock.io"}}}],"sidebar":["$","$Lf",null,{"docs":[{"slug":"concepts","filePath":"concepts","title":"Concepts","meta":{"title":"Concepts","description":"Core concepts and terminology for Aqua Protocol v3","content":"$10","reading_time":9,"word_count":1657},"content":"$11"},{"slug":"introduction","filePath":"introduction","title":"Aqua Protocol v3","meta":{"title":"Aqua Protocol v3","description":"Introduction to Aqua Protocol version 3 with JavaScript/TypeScript SDK","content":"$12","reading_time":6,"word_count":1069},"content":"$13"},{"slug":"schema","filePath":"schema","title":"Schema Reference","meta":{"title":"Schema Reference","description":"Detailed schema specifications for Aqua Protocol v3 revisions","content":"$14","reading_time":10,"word_count":1903},"content":"$15"},{"slug":"tooling","filePath":"tooling","title":"Tooling & SDK","meta":{"title":"Tooling & SDK","description":"Aqua JS SDK API reference and usage guide","content":"$16","reading_time":9,"word_count":1773},"content":"$17"}],"version":"v3.0.0","config":"$4:props:children:0:props:header:props:config"}],"content":"$L18","toc":"$L19","config":"$4:props:children:0:props:header:props:config"}],"$L1a","$L1b","$L1c"]}]
1d:I[221187,["/mint-test/_next/static/chunks/5e52b2e731b92ce4.js","/mint-test/_next/static/chunks/a37691990cb744b1.js"],"TableOfContents"]
1e:I[801024,["/mint-test/_next/static/chunks/5e52b2e731b92ce4.js","/mint-test/_next/static/chunks/a37691990cb744b1.js"],"MdxHotReload"]
1f:I[713918,["/mint-test/_next/static/chunks/5e52b2e731b92ce4.js","/mint-test/_next/static/chunks/a37691990cb744b1.js"],"HotReloadIndicator"]
20:I[694600,["/mint-test/_next/static/chunks/5e52b2e731b92ce4.js","/mint-test/_next/static/chunks/a37691990cb744b1.js"],"DevModeBadge"]
19:["$","$L1d",null,{"items":[{"id":"version-string-format","title":"Version String Format","level":2},{"id":"common-fields","title":"Common Fields","level":2},{"id":"file-revision","title":"File Revision","level":2},{"id":"fields","title":"Fields","level":3},{"id":"genesis-file-revision-scalar","title":"Genesis File Revision (Scalar)","level":3},{"id":"genesis-file-revision-tree","title":"Genesis File Revision (Tree)","level":3},{"id":"with-content","title":"With Content","level":3},{"id":"validation-rules","title":"Validation Rules","level":3},{"id":"form-revision","title":"Form Revision","level":2},{"id":"fields","title":"Fields","level":3},{"id":"example-scalar","title":"Example (Scalar)","level":3},{"id":"example-tree","title":"Example (Tree)","level":3},{"id":"leaf-computation-tree-mode","title":"Leaf Computation (Tree Mode)","level":3},{"id":"validation-rules","title":"Validation Rules","level":3},{"id":"signature-revision","title":"Signature Revision","level":2},{"id":"common-fields","title":"Common Fields","level":3},{"id":"cli--metamask-signature","title":"CLI / MetaMask Signature","level":3},{"id":"did-signature","title":"DID Signature","level":3},{"id":"p12-certificate-signature","title":"P12 Certificate Signature","level":3},{"id":"inline-signature","title":"Inline Signature","level":3},{"id":"validation-rules","title":"Validation Rules","level":3},{"id":"witness-revision","title":"Witness Revision","level":2},{"id":"fields","title":"Fields","level":3},{"id":"ethereum-witness-example","title":"Ethereum Witness Example","level":3},{"id":"batched-witness-example","title":"Batched Witness Example","level":3},{"id":"nostr-witness-example","title":"Nostr Witness Example","level":3},{"id":"tsa-witness-example","title":"TSA Witness Example","level":3},{"id":"validation-rules","title":"Validation Rules","level":3},{"id":"link-revision","title":"Link Revision","level":2},{"id":"fields","title":"Fields","level":3},{"id":"example","title":"Example","level":3},{"id":"validation-rules","title":"Validation Rules","level":3},{"id":"hash-computation","title":"Hash Computation","level":2},{"id":"scalar-method","title":"Scalar Method","level":3},{"id":"tree-method","title":"Tree Method","level":3},{"id":"aquatree-storage-format","title":"AquaTree Storage Format","level":2},{"id":"field-constraints","title":"Field Constraints","level":2},{"id":"hashes","title":"Hashes","level":3},{"id":"timestamps","title":"Timestamps","level":3},{"id":"ethereum-addresses","title":"Ethereum Addresses","level":3},{"id":"nonces","title":"Nonces","level":3},{"id":"version-compatibility","title":"Version Compatibility","level":2},{"id":"see-also","title":"See Also","level":2}],"config":"$4:props:children:0:props:header:props:config"}]
1a:["$","$L1e",null,{}]
1b:["$","$L1f",null,{}]
1c:["$","$L20",null,{}]
21:I[725689,["/mint-test/_next/static/chunks/5e52b2e731b92ce4.js","/mint-test/_next/static/chunks/a37691990cb744b1.js"],"SearchHighlight"]
22:I[522016,["/mint-test/_next/static/chunks/5e52b2e731b92ce4.js","/mint-test/_next/static/chunks/a37691990cb744b1.js"],""]
18:["$","article",null,{"className":"flex-1 min-w-0","children":[["$","$L21",null,{}],["$","nav",null,{"className":"flex items-center gap-2 text-sm text-muted-foreground mb-4","aria-label":"Breadcrumb","children":[["$","div","/docs/v3.0.0",{"className":"flex items-center gap-2","children":[false,["$","$L22",null,{"href":"/docs/v3.0.0","className":"hover:text-foreground transition-colors","children":"Docs"}]]}],["$","div","/docs/v3.0.0/schema",{"className":"flex items-center gap-2","children":[["$","svg",null,{"ref":"$undefined","xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-chevron-right h-4 w-4","children":[["$","path","mthhwq",{"d":"m9 18 6-6-6-6"}],"$undefined"]}],["$","span",null,{"className":"text-foreground font-medium","children":"Schema Reference"}]]}]]}],false,["$","div",null,{"className":"mb-8","children":[["$","h1",null,{"className":"text-4xl font-bold tracking-tight mb-3 text-foreground","children":"Schema Reference"}],["$","p",null,{"className":"text-lg text-muted-foreground leading-relaxed","children":"Detailed schema specifications for Aqua Protocol v3 revisions"}]]}],["$","div",null,{"className":"flex flex-wrap items-center gap-4 text-sm text-muted-foreground border-b border-border pb-4 mb-6","children":[["$","div",null,{"className":"flex items-center gap-1.5","children":[["$","svg",null,{"ref":"$undefined","xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-clock h-4 w-4","children":[["$","circle","1mglay",{"cx":"12","cy":"12","r":"10"}],["$","polyline","68esgv",{"points":"12 6 12 12 16 14"}],"$undefined"]}],["$","span",null,{"children":[10," min read"]}]]}],"$undefined",false]}],["$","div",null,{"className":"prose prose-slate dark:prose-invert max-w-none prose-headings:scroll-mt-24 prose-headings:font-semibold prose-h1:text-4xl prose-h2:text-3xl prose-h2:mt-12 prose-h2:mb-4 prose-h3:text-2xl prose-h3:mt-8 prose-h3:mb-3 prose-p:text-base prose-p:leading-7 prose-p:text-muted-foreground prose-p:mb-4 prose-a:font-normal prose-a:transition-all prose-code:text-primary prose-code:bg-muted/50 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded-md prose-code:text-[13px] prose-code:font-mono prose-code:border prose-code:border-border/50 prose-code:before:content-none prose-code:after:content-none prose-pre:bg-transparent prose-pre:p-0 prose-ul:list-disc prose-ul:list-inside prose-ul:space-y-2 prose-ul:mb-4 prose-ol:list-decimal prose-ol:list-inside prose-ol:space-y-2 prose-ol:mb-4 prose-li:leading-7 prose-li:text-muted-foreground prose-strong:text-foreground prose-strong:font-semibold","children":"$L23"}],"$undefined",["$","div",null,{"className":"mt-12 pt-6 border-t border-border flex items-center justify-between","children":[["$","a",null,{"href":"https://github.com/inblockio/aqua-docs/edit/main/docs/v3.0.0/schema.mdx","target":"_blank","rel":"noopener noreferrer","className":"flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors","children":[["$","svg",null,{"ref":"$undefined","xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-file-pen h-4 w-4","children":[["$","path","1couwa",{"d":"M12.5 22H18a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v9.5"}],["$","path","tnqrlb",{"d":"M14 2v4a2 2 0 0 0 2 2h4"}],["$","path","1y4qbx",{"d":"M13.378 15.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z"}],"$undefined"]}],"Edit this page"]}],["$","a",null,{"href":"https://github.com/inblockio/issues/new","target":"_blank","rel":"noopener noreferrer","className":"flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors","children":["$L24","Report an issue"]}]]}],"$L25"]}]
24:["$","svg",null,{"ref":"$undefined","xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-external-link h-4 w-4","children":[["$","path","1q9fwt",{"d":"M15 3h6v6"}],["$","path","gplh6r",{"d":"M10 14 21 3"}],["$","path","a6xqqp",{"d":"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}],"$undefined"]}]
25:["$","div",null,{"className":"mt-12 pt-8 border-t border-border grid grid-cols-2 gap-4","children":[["$","$L22",null,{"href":"/docs/v3.0.0/introduction","className":"group flex flex-col gap-2 p-4 rounded-xl border border-border hover:border-primary/50 hover:bg-muted/50 transition-all","style":{"textDecoration":"none !important"},"children":[["$","div",null,{"className":"flex items-center gap-2 text-sm text-muted-foreground","children":[["$","svg",null,{"ref":"$undefined","xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-chevron-left h-4 w-4","children":[["$","path","1wnfg3",{"d":"m15 18-6-6 6-6"}],"$undefined"]}],["$","span",null,{"children":"Previous"}]]}],["$","div",null,{"className":"text-base font-medium text-foreground group-hover:text-primary transition-colors","children":"Aqua Protocol v3"}]]}],["$","$L22",null,{"href":"/docs/v3.0.0/tooling","className":"group flex flex-col gap-2 p-4 rounded-xl border border-border hover:border-primary/50 hover:bg-muted/50 transition-all text-right","style":{"textDecoration":"none !important"},"children":[["$","div",null,{"className":"flex items-center justify-end gap-2 text-sm text-muted-foreground","children":[["$","span",null,{"children":"Next"}],["$","svg",null,{"ref":"$undefined","xmlns":"http://www.w3.org/2000/svg","width":24,"height":24,"viewBox":"0 0 24 24","fill":"none","stroke":"currentColor","strokeWidth":2,"strokeLinecap":"round","strokeLinejoin":"round","className":"lucide lucide-chevron-right h-4 w-4","children":[["$","path","mthhwq",{"d":"m9 18 6-6-6-6"}],"$undefined"]}]]}],["$","div",null,{"className":"text-base font-medium text-foreground group-hover:text-primary transition-colors","children":"Tooling & SDK"}]]}]]}]
23:[["$","h1",null,{"className":"text-4xl font-bold tracking-tight mb-6 text-foreground","children":"Aqua Protocol v3 - Schema Reference"}],"\n",["$","p",null,{"className":"text-base leading-7 text-muted-foreground mb-4","children":"This document provides comprehensive technical specifications for all revision types in Aqua Protocol v3. Each revision type has specific fields and validation rules."}],"\n",["$","h2",null,{"id":"version-string-format","className":"text-3xl font-semibold tracking-tight mt-12 mb-4 text-foreground scroll-mt-24","children":"Version String Format"}],"\n",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: {scalar|tree}\n"}],"\n",["$","p",null,{"className":"text-base leading-7 text-muted-foreground mb-4","children":["$","strong",null,{"children":"Components:"}]}],"\n",["$","ul",null,{"className":"list-disc list-inside space-y-2 mb-4 text-muted-foreground","children":["\n",["$","li",null,{"className":"leading-7","children":["Protocol URL: ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"https://aqua-protocol.org/docs/v3/schema_2"}]]}],"\n",["$","li",null,{"className":"leading-7","children":["Hash Algorithm: ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"SHA256"}]]}],"\n",["$","li",null,{"className":"leading-7","children":["Canonicalization Method: ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"scalar"}]," or ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"tree"}]]}],"\n"]}],"\n",["$","h2",null,{"id":"common-fields","className":"text-3xl font-semibold tracking-tight mt-12 mb-4 text-foreground scroll-mt-24","children":"Common Fields"}],"\n",["$","p",null,{"className":"text-base leading-7 text-muted-foreground mb-4","children":"All revisions share these mandatory fields:"}],"\n",["$","div",null,{"className":"overflow-x-auto mb-6 rounded-xl border border-border","children":["$","table",null,{"className":"min-w-full border-collapse","children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Field"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Type"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Description"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Validation"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"previous_verification_hash"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Hash of previous revision"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["Empty string for genesis, otherwise 64-char hex with ","$L26"," prefix"]}]]}],"$L27","$L28","$L29"]}]]}]}],"\n","$L2a","\n","$L2b","\n","$L2c","\n","$L2d","\n","$L2e","\n","$L2f","\n","$L30","\n","$L31","\n","$L32","\n","$L33","\n","$L34","\n","$L35","\n","$L36","\n","$L37","\n","$L38","\n","$L39","\n","$L3a","\n","$L3b","\n","$L3c","\n","$L3d","\n","$L3e","\n","$L3f","\n","$L40","\n","$L41","\n","$L42","\n","$L43","\n","$L44","\n","$L45","\n","$L46","\n","$L47","\n","$L48","\n","$L49","\n","$L4a","\n","$L4b","\n","$L4c","\n","$L4d","\n","$L4e","\n","$L4f","\n","$L50","\n","$L51","\n","$L52","\n","$L53","\n","$L54","\n","$L55","\n","$L56","\n","$L57","\n","$L58","\n","$L59","\n","$L5a","\n","$L5b","\n","$L5c","\n","$L5d","\n","$L5e","\n","$L5f","\n","$L60","\n","$L61","\n","$L62","\n","$L63","\n","$L64","\n","$L65","\n","$L66","\n","$L67","\n","$L68","\n","$L69","\n","$L6a","\n","$L6b","\n","$L6c","\n","$L6d","\n","$L6e","\n","$L6f","\n","$L70","\n","$L71","\n","$L72","\n","$L73","\n","$L74","\n","$L75","\n","$L76","\n","$L77","\n","$L78","\n","$L79","\n","$L7a","\n","$L7b","\n","$L7c","\n","$L7d","\n","$L7e","\n","$L7f","\n","$L80","\n","$L81","\n","$L82","\n","$L83","\n","$L84","\n","$L85","\n","$L86","\n","$L87","\n","$L88","\n","$L89","\n","$L8a","\n","$L8b","\n","$L8c","\n","$L8d","\n","$L8e","\n","$L8f","\n","$L90","\n","$L91","\n","$L92","\n","$L93"]
98:I[222506,["/mint-test/_next/static/chunks/5e52b2e731b92ce4.js","/mint-test/_next/static/chunks/a37691990cb744b1.js"],"CodeBlock"]
26:["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"0x"}]
27:["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"local_timestamp"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"ISO 8601 timestamp"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["Valid ISO 8601 format: ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"YYYY-MM-DDTHH:mm:ss"}]]}]]}]
28:["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"revision_type"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Type of revision"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["One of: ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"\"file\""}],", ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"\"form\""}],", ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"\"signature\""}],", ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"\"witness\""}],", ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"\"link\""}]]}]]}]
29:["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"version"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Protocol version and method"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Must match format above"}]]}]
2a:["$","hr",null,{}]
2b:["$","h2",null,{"id":"file-revision","className":"text-3xl font-semibold tracking-tight mt-12 mb-4 text-foreground scroll-mt-24","children":"File Revision"}]
2c:["$","p",null,{"className":"text-base leading-7 text-muted-foreground mb-4","children":"Represents a file with metadata and optional content."}]
2d:["$","h3",null,{"id":"fields","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Fields"}]
2e:["$","div",null,{"className":"overflow-x-auto mb-6 rounded-xl border border-border","children":["$","table",null,{"className":"min-w-full border-collapse","children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Field"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Type"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Required"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Description"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"previous_verification_hash"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Previous revision hash (empty for genesis)"}]]}],["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"local_timestamp"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"ISO 8601 timestamp"}]]}],["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"revision_type"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["Must be ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"\"file\""}]]}]]}],["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"version"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Protocol version string"}]]}],"$L94","$L95","$L96","$L97"]}]]}]}]
2f:["$","h3",null,{"id":"genesis-file-revision-scalar","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Genesis File Revision (Scalar)"}]
30:["$","$L98",null,{"code":"{\n  \"previous_verification_hash\": \"\",\n  \"local_timestamp\": \"2024-01-01T12:00:00\",\n  \"revision_type\": \"file\",\n  \"version\": \"https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar\",\n  \"file_hash\": \"0x9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08\",\n  \"file_nonce\": \"0x3fa8b1c2d3e4f5a67b8c9d0e1f2a3b4c\"\n}","language":"json","filename":"$undefined"}]
31:["$","h3",null,{"id":"genesis-file-revision-tree","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Genesis File Revision (Tree)"}]
32:["$","$L98",null,{"code":"{\n  \"previous_verification_hash\": \"\",\n  \"local_timestamp\": \"2024-01-01T12:00:00\",\n  \"revision_type\": \"file\",\n  \"version\": \"https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: tree\",\n  \"file_hash\": \"0x9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08\",\n  \"file_nonce\": \"0x3fa8b1c2d3e4f5a67b8c9d0e1f2a3b4c\",\n  \"leaves\": [\n    \"0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef\",\n    \"0xabcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890\"\n  ]\n}","language":"json","filename":"$undefined"}]
33:["$","h3",null,{"id":"with-content","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"With Content"}]
34:["$","$L98",null,{"code":"{\n  \"previous_verification_hash\": \"\",\n  \"local_timestamp\": \"2024-01-01T12:00:00\",\n  \"revision_type\": \"file\",\n  \"version\": \"https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar\",\n  \"file_hash\": \"0x9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08\",\n  \"file_nonce\": \"0x3fa8b1c2d3e4f5a67b8c9d0e1f2a3b4c\",\n  \"content\": \"This is the file content as a string\"\n}","language":"json","filename":"$undefined"}]
35:["$","h3",null,{"id":"validation-rules","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Validation Rules"}]
36:["$","ol",null,{"className":"list-decimal list-inside space-y-2 mb-4 text-muted-foreground","children":["\n",["$","li",null,{"className":"leading-7","children":[["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"file_hash"}]," must match SHA256 of file content"]}],"\n",["$","li",null,{"className":"leading-7","children":[["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"file_nonce"}]," must be exactly 16 bytes (32 hex chars + ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"0x"}],")"]}],"\n",["$","li",null,{"className":"leading-7","children":["If ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"Method: tree"}],", ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"leaves"}]," array must be present"]}],"\n",["$","li",null,{"className":"leading-7","children":["If ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"Method: scalar"}],", ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"leaves"}]," must be absent"]}],"\n",["$","li",null,{"className":"leading-7","children":[["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"content"}]," is optional but if present, hash must match ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"file_hash"}]]}],"\n"]}]
37:["$","hr",null,{}]
38:["$","h2",null,{"id":"form-revision","className":"text-3xl font-semibold tracking-tight mt-12 mb-4 text-foreground scroll-mt-24","children":"Form Revision"}]
39:["$","p",null,{"className":"text-base leading-7 text-muted-foreground mb-4","children":"Stores structured key-value data."}]
3a:["$","h3",null,{"id":"fields-1","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Fields"}]
3b:["$","div",null,{"className":"overflow-x-auto mb-6 rounded-xl border border-border","children":["$","table",null,{"className":"min-w-full border-collapse","children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Field"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Type"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Required"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Description"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"previous_verification_hash"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Previous revision hash (empty for genesis)"}]]}],["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"local_timestamp"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"ISO 8601 timestamp"}]]}],["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"revision_type"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["Must be ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"\"form\""}]]}]]}],["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"version"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Protocol version string"}]]}],"$L99","$L9a","$L9b","$L9c"]}]]}]}]
3c:["$","h3",null,{"id":"example-scalar","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Example (Scalar)"}]
3d:["$","$L98",null,{"code":"{\n  \"previous_verification_hash\": \"\",\n  \"local_timestamp\": \"2024-01-01T12:00:00\",\n  \"revision_type\": \"form\",\n  \"version\": \"https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar\",\n  \"file_hash\": \"0xabc123def456...\",\n  \"file_nonce\": \"0x7c8d9e0f1a2b3c4d5e6f7a8b9c0d1e2f\",\n  \"content\": {\n    \"name\": \"John Doe\",\n    \"email\": \"john@example.com\",\n    \"organization\": \"Example Corp\",\n    \"role\": \"Developer\"\n  }\n}","language":"json","filename":"$undefined"}]
3e:["$","h3",null,{"id":"example-tree","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Example (Tree)"}]
3f:["$","$L98",null,{"code":"{\n  \"previous_verification_hash\": \"\",\n  \"local_timestamp\": \"2024-01-01T12:00:00\",\n  \"revision_type\": \"form\",\n  \"version\": \"https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: tree\",\n  \"file_hash\": \"0xabc123def456...\",\n  \"file_nonce\": \"0x7c8d9e0f1a2b3c4d5e6f7a8b9c0d1e2f\",\n  \"content\": {\n    \"name\": \"John Doe\",\n    \"email\": \"john@example.com\",\n    \"organization\": \"Example Corp\",\n    \"role\": \"Developer\"\n  },\n  \"leaves\": [\n    \"0x...\",  // SHA256(\"name:John Doe\")\n    \"0x...\",  // SHA256(\"email:john@example.com\")\n    \"0x...\",  // SHA256(\"organization:Example Corp\")\n    \"0x...\"   // SHA256(\"role:Developer\")\n  ]\n}","language":"json","filename":"$undefined"}]
40:["$","h3",null,{"id":"leaf-computation-tree-mode","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Leaf Computation (Tree Mode)"}]
41:["$","p",null,{"className":"text-base leading-7 text-muted-foreground mb-4","children":["For each key-value pair in ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"content"}],":"]}]
42:["$","$L98",null,{"code":"leaf_hash = SHA256(`${key}:${value}`)","language":"typescript","filename":"$undefined"}]
43:["$","h3",null,{"id":"validation-rules-1","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Validation Rules"}]
44:["$","ol",null,{"className":"list-decimal list-inside space-y-2 mb-4 text-muted-foreground","children":["\n",["$","li",null,{"className":"leading-7","children":[["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"content"}]," must be a valid JSON object"]}],"\n",["$","li",null,{"className":"leading-7","children":["All values in ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"content"}]," must be strings"]}],"\n",["$","li",null,{"className":"leading-7","children":[["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"file_hash"}]," must match hash of canonicalized content"]}],"\n",["$","li",null,{"className":"leading-7","children":["If ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"Method: tree"}],", number of leaves must match number of keys in content"]}],"\n"]}]
45:["$","hr",null,{}]
46:["$","h2",null,{"id":"signature-revision","className":"text-3xl font-semibold tracking-tight mt-12 mb-4 text-foreground scroll-mt-24","children":"Signature Revision"}]
47:["$","p",null,{"className":"text-base leading-7 text-muted-foreground mb-4","children":"Adds cryptographic signature to verify authenticity."}]
48:["$","h3",null,{"id":"common-fields-1","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Common Fields"}]
49:["$","div",null,{"className":"overflow-x-auto mb-6 rounded-xl border border-border","children":["$","table",null,{"className":"min-w-full border-collapse","children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Field"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Type"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Required"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Description"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"previous_verification_hash"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Hash of revision being signed"}]]}],["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"local_timestamp"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"ISO 8601 timestamp"}]]}],["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"revision_type"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["Must be ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"\"signature\""}]]}]]}],["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"version"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Protocol version string"}]]}],"$L9d"]}]]}]}]
4a:["$","h3",null,{"id":"cli--metamask-signature","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"CLI / MetaMask Signature"}]
4b:["$","p",null,{"className":"text-base leading-7 text-muted-foreground mb-4","children":["$","strong",null,{"children":"Additional Fields:"}]}]
4c:["$","div",null,{"className":"overflow-x-auto mb-6 rounded-xl border border-border","children":["$","table",null,{"className":"min-w-full border-collapse","children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Field"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Type"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Required"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Description"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"signature"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Hex-encoded signature (65 bytes for ECDSA)"}]]}],["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"signature_wallet_address"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Ethereum address (EIP-55 checksummed)"}]]}]]}]]}]}]
4d:["$","p",null,{"className":"text-base leading-7 text-muted-foreground mb-4","children":["$","strong",null,{"children":"Example:"}]}]
4e:["$","$L98",null,{"code":"{\n  \"previous_verification_hash\": \"0xabc123...\",\n  \"local_timestamp\": \"2024-01-01T12:01:00\",\n  \"revision_type\": \"signature\",\n  \"version\": \"https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar\",\n  \"signature_type\": \"cli\",\n  \"signature\": \"0x8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2c3d4e5f6a7b8c9d1c\",\n  \"signature_wallet_address\": \"0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb8\"\n}","language":"json","filename":"$undefined"}]
4f:["$","h3",null,{"id":"did-signature","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"DID Signature"}]
50:["$","p",null,{"className":"text-base leading-7 text-muted-foreground mb-4","children":["$","strong",null,{"children":"Additional Fields:"}]}]
51:["$","div",null,{"className":"overflow-x-auto mb-6 rounded-xl border border-border","children":["$","table",null,{"className":"min-w-full border-collapse","children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Field"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Type"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Required"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Description"}]]}]}],["$","tbody",null,{"children":["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"signature"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"object"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"JWS (JSON Web Signature) object"}]]}]}]]}]}]
52:["$","p",null,{"className":"text-base leading-7 text-muted-foreground mb-4","children":["$","strong",null,{"children":"Signature Object Structure:"}]}]
53:["$","$L98",null,{"code":"{\n  payload: string;       // Base64url-encoded payload\n  signatures: [{\n    protected: string;   // Base64url-encoded protected header\n    signature: string;   // Base64url-encoded signature\n  }]\n}","language":"typescript","filename":"$undefined"}]
54:["$","p",null,{"className":"text-base leading-7 text-muted-foreground mb-4","children":["$","strong",null,{"children":"Example:"}]}]
55:["$","$L98",null,{"code":"{\n  \"previous_verification_hash\": \"0xabc123...\",\n  \"local_timestamp\": \"2024-01-01T12:01:00\",\n  \"revision_type\": \"signature\",\n  \"version\": \"https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar\",\n  \"signature_type\": \"did\",\n  \"signature\": {\n    \"payload\": \"eyJhbGciOiJFZERTQSIsImI2NCI6ZmFsc2UsImNyaXQiOlsiYjY0Il19\",\n    \"signatures\": [{\n      \"protected\": \"eyJhbGciOiJFZERTQSJ9\",\n      \"signature\": \"kKvXJ_qjJRtGQFLpRvQlCdXMFD8sSE4DTlbMmLqg0BJ9FQKLHvX7y_z5Pr8u0xT8D2vCj9qL1KzN4rP2MzKfBQ\"\n    }]\n  }\n}","language":"json","filename":"$undefined"}]
56:["$","h3",null,{"id":"p12-certificate-signature","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"P12 Certificate Signature"}]
57:["$","p",null,{"className":"text-base leading-7 text-muted-foreground mb-4","children":["$","strong",null,{"children":"Additional Fields:"}]}]
58:["$","div",null,{"className":"overflow-x-auto mb-6 rounded-xl border border-border","children":["$","table",null,{"className":"min-w-full border-collapse","children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Field"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Type"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Required"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Description"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"signature"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Hex-encoded signature"}]]}],["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"signature_public_key"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Hex-encoded DER public key"}]]}]]}]]}]}]
59:["$","p",null,{"className":"text-base leading-7 text-muted-foreground mb-4","children":["$","strong",null,{"children":"Example:"}]}]
5a:["$","$L98",null,{"code":"{\n  \"previous_verification_hash\": \"0xabc123...\",\n  \"local_timestamp\": \"2024-01-01T12:01:00\",\n  \"revision_type\": \"signature\",\n  \"version\": \"https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar\",\n  \"signature_type\": \"p12\",\n  \"signature\": \"0x...\",\n  \"signature_public_key\": \"0x308201a2300d06092a864886f70d01010105000382018f...\"\n}","language":"json","filename":"$undefined"}]
5b:["$","h3",null,{"id":"inline-signature","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Inline Signature"}]
5c:["$","p",null,{"className":"text-base leading-7 text-muted-foreground mb-4","children":"Same as CLI/MetaMask but with pre-computed signature."}]
5d:["$","h3",null,{"id":"validation-rules-2","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Validation Rules"}]
5e:["$","ol",null,{"className":"list-decimal list-inside space-y-2 mb-4 text-muted-foreground","children":["\n",["$","li",null,{"className":"leading-7","children":"Signature must be verifiable using provided credentials"}],"\n",["$","li",null,{"className":"leading-7","children":"For CLI/MetaMask: Address must be recoverable from signature"}],"\n",["$","li",null,{"className":"leading-7","children":"For DID: JWS must be valid and verifiable"}],"\n",["$","li",null,{"className":"leading-7","children":"For P12: Signature must verify with public key"}],"\n",["$","li",null,{"className":"leading-7","children":["Signature must be computed over ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"previous_verification_hash"}]]}],"\n"]}]
5f:["$","hr",null,{}]
60:["$","h2",null,{"id":"witness-revision","className":"text-3xl font-semibold tracking-tight mt-12 mb-4 text-foreground scroll-mt-24","children":"Witness Revision"}]
61:["$","p",null,{"className":"text-base leading-7 text-muted-foreground mb-4","children":"Anchors revision to blockchain or timestamping service."}]
62:["$","h3",null,{"id":"fields-2","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Fields"}]
63:["$","div",null,{"className":"overflow-x-auto mb-6 rounded-xl border border-border","children":["$","table",null,{"className":"min-w-full border-collapse","children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Field"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Type"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Required"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Description"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"previous_verification_hash"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Hash being witnessed"}]]}],["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"local_timestamp"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"ISO 8601 timestamp"}]]}],["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"revision_type"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["Must be ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"\"witness\""}]]}]]}],["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"version"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Protocol version string"}]]}],"$L9e","$L9f","$La0","$La1","$La2","$La3","$La4"]}]]}]}]
64:["$","h3",null,{"id":"ethereum-witness-example","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Ethereum Witness Example"}]
65:["$","$L98",null,{"code":"{\n  \"previous_verification_hash\": \"0xabc123...\",\n  \"local_timestamp\": \"2024-01-01T12:02:00\",\n  \"revision_type\": \"witness\",\n  \"version\": \"https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar\",\n  \"witness_merkle_root\": \"0xdef456...\",\n  \"witness_timestamp\": 1704110520,\n  \"witness_network\": \"sepolia\",\n  \"witness_smart_contract_address\": \"0x5FbDB2315678afecb367f032d93F642f64180aa3\",\n  \"witness_transaction_hash\": \"0x9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08\",\n  \"witness_sender_account_address\": \"0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb8\",\n  \"witness_merkle_proof\": []\n}","language":"json","filename":"$undefined"}]
66:["$","h3",null,{"id":"batched-witness-example","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Batched Witness Example"}]
67:["$","p",null,{"className":"text-base leading-7 text-muted-foreground mb-4","children":"Multiple revisions witnessed in single transaction:"}]
68:["$","$L98",null,{"code":"{\n  \"previous_verification_hash\": \"0xabc123...\",\n  \"local_timestamp\": \"2024-01-01T12:02:00\",\n  \"revision_type\": \"witness\",\n  \"version\": \"https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar\",\n  \"witness_merkle_root\": \"0xroot...\",\n  \"witness_timestamp\": 1704110520,\n  \"witness_network\": \"mainnet\",\n  \"witness_smart_contract_address\": \"0x5FbDB2315678afecb367f032d93F642f64180aa3\",\n  \"witness_transaction_hash\": \"0x9f86d081...\",\n  \"witness_sender_account_address\": \"0x742d35Cc...\",\n  \"witness_merkle_proof\": [\n    \"0xsibling_hash_1\",\n    \"0xsibling_hash_2\",\n    \"0xsibling_hash_3\"\n  ]\n}","language":"json","filename":"$undefined"}]
69:["$","h3",null,{"id":"nostr-witness-example","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Nostr Witness Example"}]
6a:["$","$L98",null,{"code":"{\n  \"previous_verification_hash\": \"0xabc123...\",\n  \"local_timestamp\": \"2024-01-01T12:02:00\",\n  \"revision_type\": \"witness\",\n  \"version\": \"https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar\",\n  \"witness_merkle_root\": \"0xabc123...\",\n  \"witness_timestamp\": 1704110520,\n  \"witness_network\": \"nostr\",\n  \"witness_smart_contract_address\": \"\",\n  \"witness_transaction_hash\": \"nevent1qqsw...\",\n  \"witness_sender_account_address\": \"npub1...\",\n  \"witness_merkle_proof\": []\n}","language":"json","filename":"$undefined"}]
6b:["$","h3",null,{"id":"tsa-witness-example","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"TSA Witness Example"}]
6c:["$","$L98",null,{"code":"{\n  \"previous_verification_hash\": \"0xabc123...\",\n  \"local_timestamp\": \"2024-01-01T12:02:00\",\n  \"revision_type\": \"witness\",\n  \"version\": \"https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar\",\n  \"witness_merkle_root\": \"0xabc123...\",\n  \"witness_timestamp\": 1704110520,\n  \"witness_network\": \"tsa\",\n  \"witness_smart_contract_address\": \"https://timestamp.digicert.com\",\n  \"witness_transaction_hash\": \"base64_tsa_response\",\n  \"witness_sender_account_address\": \"\",\n  \"witness_merkle_proof\": []\n}","language":"json","filename":"$undefined"}]
6d:["$","h3",null,{"id":"validation-rules-3","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Validation Rules"}]
6e:["$","ol",null,{"className":"list-decimal list-inside space-y-2 mb-4 text-muted-foreground","children":["\n",["$","li",null,{"className":"leading-7","children":["For single witness: ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"witness_merkle_proof"}]," must be empty array"]}],"\n",["$","li",null,{"className":"leading-7","children":["For single witness: ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"witness_merkle_root"}]," equals ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"previous_verification_hash"}]]}],"\n",["$","li",null,{"className":"leading-7","children":["For batched: Merkle proof must verify back to ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"witness_merkle_root"}]]}],"\n",["$","li",null,{"className":"leading-7","children":"Transaction must exist and be confirmed on specified network"}],"\n",["$","li",null,{"className":"leading-7","children":[["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"witness_timestamp"}]," should match blockchain/service timestamp"]}],"\n",["$","li",null,{"className":"leading-7","children":"For Ethereum: Contract address and sender address required"}],"\n"]}]
6f:["$","hr",null,{}]
70:["$","h2",null,{"id":"link-revision","className":"text-3xl font-semibold tracking-tight mt-12 mb-4 text-foreground scroll-mt-24","children":"Link Revision"}]
71:["$","p",null,{"className":"text-base leading-7 text-muted-foreground mb-4","children":"Connects to other AquaTree chains."}]
72:["$","h3",null,{"id":"fields-3","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Fields"}]
73:["$","div",null,{"className":"overflow-x-auto mb-6 rounded-xl border border-border","children":["$","table",null,{"className":"min-w-full border-collapse","children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Field"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Type"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Required"}],["$","th",null,{"className":"border-b border-r border-border bg-muted px-4 py-2 text-left font-semibold text-foreground last:border-r-0","children":"Description"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"previous_verification_hash"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Previous revision in this chain"}]]}],["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"local_timestamp"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"ISO 8601 timestamp"}]]}],["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"revision_type"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["Must be ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"\"link\""}]]}]]}],["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"version"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Protocol version string"}]]}],"$La5","$La6","$La7"]}]]}]}]
74:["$","h3",null,{"id":"example","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Example"}]
75:["$","$L98",null,{"code":"{\n  \"previous_verification_hash\": \"0xabc123...\",\n  \"local_timestamp\": \"2024-01-01T12:03:00\",\n  \"revision_type\": \"link\",\n  \"version\": \"https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar\",\n  \"link_type\": \"dependencies\",\n  \"link_verification_hashes\": [\n    \"0x111222333444555666777888999000aaabbbcccdddeeefff000111222333444\",\n    \"0x222333444555666777888999000aaabbbcccdddeeefff000111222333444555\",\n    \"0x333444555666777888999000aaabbbcccdddeeefff000111222333444555666\"\n  ],\n  \"link_file_hashes\": [\n    \"0xfileHash1...\",\n    \"0xfileHash2...\",\n    \"0xfileHash3...\"\n  ]\n}","language":"json","filename":"$undefined"}]
76:["$","h3",null,{"id":"validation-rules-4","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Validation Rules"}]
77:["$","ol",null,{"className":"list-decimal list-inside space-y-2 mb-4 text-muted-foreground","children":["\n",["$","li",null,{"className":"leading-7","children":[["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"link_verification_hashes"}]," must be non-empty array"]}],"\n",["$","li",null,{"className":"leading-7","children":"Each hash in array must be valid revision hash"}],"\n",["$","li",null,{"className":"leading-7","children":["If ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"link_file_hashes"}]," present, must have same length as ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"link_verification_hashes"}]]}],"\n",["$","li",null,{"className":"leading-7","children":"Referenced revisions should exist (optional strict validation)"}],"\n"]}]
78:["$","hr",null,{}]
79:["$","h2",null,{"id":"hash-computation","className":"text-3xl font-semibold tracking-tight mt-12 mb-4 text-foreground scroll-mt-24","children":"Hash Computation"}]
7a:["$","h3",null,{"id":"scalar-method","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Scalar Method"}]
7b:["$","ol",null,{"className":"list-decimal list-inside space-y-2 mb-4 text-muted-foreground","children":["\n",["$","li",null,{"className":"leading-7","children":"Serialize revision as canonical JSON (sorted keys)"}],"\n",["$","li",null,{"className":"leading-7","children":"Compute SHA256 hash of serialized string"}],"\n",["$","li",null,{"className":"leading-7","children":["Prefix with ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"0x"}]]}],"\n"]}]
7c:["$","$L98",null,{"code":"const canonical = JSON.stringify(sortKeys(revision));\nconst hash = \"0x\" + sha256(canonical).toString('hex');","language":"typescript","filename":"$undefined"}]
7d:["$","h3",null,{"id":"tree-method","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Tree Method"}]
7e:["$","ol",null,{"className":"list-decimal list-inside space-y-2 mb-4 text-muted-foreground","children":["\n",["$","li",null,{"className":"leading-7","children":"Extract leaves array from revision"}],"\n",["$","li",null,{"className":"leading-7","children":"Build Merkle tree from leaves"}],"\n",["$","li",null,{"className":"leading-7","children":"Root hash becomes verification hash"}],"\n"]}]
7f:["$","$L98",null,{"code":"const leaves = revision.leaves;\nconst tree = new MerkleTree(leaves, sha256);\nconst hash = \"0x\" + tree.getRoot().toString('hex');","language":"typescript","filename":"$undefined"}]
80:["$","hr",null,{}]
81:["$","h2",null,{"id":"aquatree-storage-format","className":"text-3xl font-semibold tracking-tight mt-12 mb-4 text-foreground scroll-mt-24","children":"AquaTree Storage Format"}]
82:["$","p",null,{"className":"text-base leading-7 text-muted-foreground mb-4","children":"Complete AquaTree structure for storage/transmission:"}]
a8:T705,{
  "revisions": {
    "0xgenesis_hash": {
      "previous_verification_hash": "",
      "local_timestamp": "2024-01-01T12:00:00",
      "revision_type": "file",
      "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
      "file_hash": "0x...",
      "file_nonce": "0x..."
    },
    "0xsignature_hash": {
      "previous_verification_hash": "0xgenesis_hash",
      "local_timestamp": "2024-01-01T12:01:00",
      "revision_type": "signature",
      "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
      "signature_type": "cli",
      "signature": "0x...",
      "signature_wallet_address": "0x..."
    },
    "0xwitness_hash": {
      "previous_verification_hash": "0xsignature_hash",
      "local_timestamp": "2024-01-01T12:02:00",
      "revision_type": "witness",
      "version": "https://aqua-protocol.org/docs/v3/schema_2 | SHA256 | Method: scalar",
      "witness_merkle_root": "0x...",
      "witness_timestamp": 1704110520,
      "witness_network": "sepolia",
      "witness_smart_contract_address": "0x...",
      "witness_transaction_hash": "0x...",
      "witness_sender_account_address": "0x...",
      "witness_merkle_proof": []
    }
  },
  "file_index": {
    "0xfile_hash": "document.pdf"
  },
  "tree": {
    "hash": "0xgenesis_hash",
    "children": [
      {
        "hash": "0xsignature_hash",
        "children": [
          {
            "hash": "0xwitness_hash",
            "children": []
          }
        ]
      }
    ]
  },
  "treeMapping": {
    "paths": {
      "0xgenesis_hash": ["0xgenesis_hash"],
      "0xsignature_hash": ["0xgenesis_hash", "0xsignature_hash"],
      "0xwitness_hash": ["0xgenesis_hash", "0xsignature_hash", "0xwitness_hash"]
    },
    "latestHash": "0xwitness_hash"
  }
}83:["$","$L98",null,{"code":"$a8","language":"json","filename":"$undefined"}]
84:["$","hr",null,{}]
85:["$","h2",null,{"id":"field-constraints","className":"text-3xl font-semibold tracking-tight mt-12 mb-4 text-foreground scroll-mt-24","children":"Field Constraints"}]
86:["$","h3",null,{"id":"hashes","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Hashes"}]
87:["$","ul",null,{"className":"list-disc list-inside space-y-2 mb-4 text-muted-foreground","children":["\n",["$","li",null,{"className":"leading-7","children":["Format: Lowercase hexadecimal with ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"0x"}]," prefix"]}],"\n",["$","li",null,{"className":"leading-7","children":"Length: 64 characters (32 bytes) + 2-char prefix = 66 total"}],"\n",["$","li",null,{"className":"leading-7","children":["Example: ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"0x9f86d081884c7d659a2feaa0c55ad015a3bf4f1b2b0b822cd15d6c15b0f00a08"}]]}],"\n"]}]
88:["$","h3",null,{"id":"timestamps","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Timestamps"}]
89:["$","ul",null,{"className":"list-disc list-inside space-y-2 mb-4 text-muted-foreground","children":["\n",["$","li",null,{"className":"leading-7","children":"Format: ISO 8601"}],"\n",["$","li",null,{"className":"leading-7","children":["Pattern: ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"YYYY-MM-DDTHH:mm:ss"}]]}],"\n",["$","li",null,{"className":"leading-7","children":["Example: ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"2024-01-01T12:00:00"}]]}],"\n"]}]
8a:["$","h3",null,{"id":"ethereum-addresses","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Ethereum Addresses"}]
8b:["$","ul",null,{"className":"list-disc list-inside space-y-2 mb-4 text-muted-foreground","children":["\n",["$","li",null,{"className":"leading-7","children":"Format: EIP-55 checksummed"}],"\n",["$","li",null,{"className":"leading-7","children":"Length: 42 characters (20 bytes + 0x)"}],"\n",["$","li",null,{"className":"leading-7","children":"Mixed case for checksum"}],"\n",["$","li",null,{"className":"leading-7","children":["Example: ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb8"}]]}],"\n"]}]
8c:["$","h3",null,{"id":"nonces","className":"text-2xl font-semibold tracking-tight mt-8 mb-3 text-foreground scroll-mt-24","children":"Nonces"}]
8d:["$","ul",null,{"className":"list-disc list-inside space-y-2 mb-4 text-muted-foreground","children":["\n",["$","li",null,{"className":"leading-7","children":"Length: Exactly 16 bytes (32 hex chars + 0x)"}],"\n",["$","li",null,{"className":"leading-7","children":["Format: Lowercase hexadecimal with ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"0x"}]," prefix"]}],"\n",["$","li",null,{"className":"leading-7","children":["Example: ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"0x3fa8b1c2d3e4f5a67b8c9d0e1f2a3b4c"}]]}],"\n"]}]
8e:["$","hr",null,{}]
8f:["$","h2",null,{"id":"version-compatibility","className":"text-3xl font-semibold tracking-tight mt-12 mb-4 text-foreground scroll-mt-24","children":"Version Compatibility"}]
90:["$","ul",null,{"className":"list-disc list-inside space-y-2 mb-4 text-muted-foreground","children":["\n",["$","li",null,{"className":"leading-7","children":[["$","strong",null,{"children":"v3.2.x"}],": Current version, fully compatible"]}],"\n",["$","li",null,{"className":"leading-7","children":[["$","strong",null,{"children":"v3.1.x"}],": Compatible, minor improvements"]}],"\n",["$","li",null,{"className":"leading-7","children":[["$","strong",null,{"children":"v3.0.x"}],": Compatible, initial TypeScript release"]}],"\n",["$","li",null,{"className":"leading-7","children":[["$","strong",null,{"children":"v2.x"}],": Not compatible, different schema"]}],"\n"]}]
91:["$","hr",null,{}]
92:["$","h2",null,{"id":"see-also","className":"text-3xl font-semibold tracking-tight mt-12 mb-4 text-foreground scroll-mt-24","children":"See Also"}]
93:["$","ul",null,{"className":"list-disc list-inside space-y-2 mb-4 text-muted-foreground","children":["\n",["$","li",null,{"className":"leading-7","children":[["$","a",null,{"href":"/previous_versions/version_3/introduction","className":"text-primary hover:underline font-medium","target":"$undefined","rel":"$undefined","children":"Introduction"}]," - Getting started"]}],"\n",["$","li",null,{"className":"leading-7","children":[["$","a",null,{"href":"/previous_versions/version_3/concepts","className":"text-primary hover:underline font-medium","target":"$undefined","rel":"$undefined","children":"Concepts"}]," - Core concepts"]}],"\n",["$","li",null,{"className":"leading-7","children":[["$","a",null,{"href":"/previous_versions/version_3/tooling","className":"text-primary hover:underline font-medium","target":"$undefined","rel":"$undefined","children":"Tooling"}]," - SDK API reference"]}],"\n"]}]
94:["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"file_hash"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["SHA256 hash of file content (hex with ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"0x"}],")"]}]]}]
95:["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"file_nonce"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["Random 16-byte nonce (hex with ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"0x"}],")"]}]]}]
96:["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"content"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string/Uint8Array"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"No"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Optional file content"}]]}]
97:["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"leaves"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string[]"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Conditional"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["Required if ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"Method: tree"}],", array of leaf hashes"]}]]}]
99:["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"file_hash"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"SHA256 hash of form data"}]]}]
9a:["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"file_nonce"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Random 16-byte nonce"}]]}]
9b:["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"content"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"object"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Form data as key-value pairs"}]]}]
9c:["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"leaves"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string[]"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Conditional"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["Required if ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"Method: tree"}]]}]]}]
9d:["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"signature_type"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["Type: ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"\"cli\""}],", ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"\"metamask\""}],", ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"\"did\""}],", ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"\"p12\""}],", ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"\"inline\""}]]}]]}]
9e:["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"witness_merkle_root"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Root hash of Merkle tree"}]]}]
9f:["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"witness_timestamp"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"number"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Unix timestamp from witness service"}]]}]
a0:["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"witness_network"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["Network: ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"\"mainnet\""}],", ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"\"sepolia\""}],", ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"\"holesky\""}],", ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"\"tsa\""}],", ",["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"\"nostr\""}]]}]]}]
a1:["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"witness_smart_contract_address"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Conditional"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Required for Ethereum"}]]}]
a2:["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"witness_transaction_hash"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Transaction or event hash"}]]}]
a3:["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"witness_sender_account_address"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Conditional"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Required for Ethereum"}]]}]
a4:["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"witness_merkle_proof"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string[]"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Merkle proof (empty for single witness)"}]]}]
a5:["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"link_type"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"No"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Application-specific link type"}]]}]
a6:["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"link_verification_hashes"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string[]"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Yes"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Array of hashes from other chains"}]]}]
a7:["$","tr",null,{"children":[["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":["$","code",null,{"className":"px-1.5 py-0.5 rounded-md bg-muted/50 text-primary font-mono text-[13px] border border-border/50","children":"link_file_hashes"}]}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"string[]"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"No"}],["$","td",null,{"className":"border-b border-r border-border px-4 py-2 text-muted-foreground last:border-r-0","children":"Corresponding file hashes"}]]}]
9:[["$","meta","0",{"charSet":"utf-8"}],["$","meta","1",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
a9:I[27201,["/mint-test/_next/static/chunks/d96012bcfc98706a.js","/mint-test/_next/static/chunks/d80b3790a119a285.js"],"IconMark"]
b:[["$","title","0",{"children":"Schema Reference | Aqua Protocol Documentation"}],["$","meta","1",{"name":"description","content":"Detailed schema specifications for Aqua Protocol v3 revisions"}],["$","meta","2",{"name":"generator","content":"v0.app"}],["$","link","3",{"rel":"canonical","href":"https://docs.aquaprotocol.org/docs/v3.0.0/schema"}],["$","meta","4",{"property":"og:title","content":"Schema Reference"}],["$","meta","5",{"property":"og:description","content":"Detailed schema specifications for Aqua Protocol v3 revisions"}],["$","meta","6",{"property":"og:url","content":"https://docs.aquaprotocol.org/docs/v3.0.0/schema"}],["$","meta","7",{"property":"og:site_name","content":"Documentation Platform"}],["$","meta","8",{"property":"og:locale","content":"en_US"}],["$","meta","9",{"property":"og:type","content":"article"}],["$","meta","10",{"name":"twitter:card","content":"summary_large_image"}],["$","meta","11",{"name":"twitter:title","content":"Schema Reference"}],["$","meta","12",{"name":"twitter:description","content":"Detailed schema specifications for Aqua Protocol v3 revisions"}],["$","link","13",{"rel":"icon","href":"/mint-test/logo/aqua-logo.png"}],["$","link","14",{"rel":"apple-touch-icon","href":"/mint-test/apple-icon.png"}],["$","$La9","15",{}]]
7:null
